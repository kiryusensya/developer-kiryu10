<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>kiryu-sensya</title>
    <link rel="icon" href="https://static.wixstatic.com/media/2f0694_eb4d3063598a4cc5b6bd6b8e31cba915~mv2.png/v1/crop/x_248,y_0,w_1065,h_950/fill/w_816,h_728,al_c,q_90,usm_0.66_1.00_0.01,enc_avif,quality_auto/1767545356653.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Noto+Sans+KR:wght@400;500;700&family=Outfit:wght@400;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* =========================================
           FONT DEFINITIONS & LICENSE NOTICE
           ========================================= */
        @font-face {
            font-family: 'HarmonyOS Sans';
            src: url('./assets/fonts/HarmonyOS_Sans_Regular.woff') format('woff'); 
            font-weight: 400;
            font-style: normal;
        }
        @font-face {
            font-family: 'HarmonyOS Sans';
            src: url('./assets/fonts/HarmonyOS_Sans_Bold.woff') format('woff'); 
            font-weight: 700;
            font-style: normal;
        }
        @font-face {
            font-family: 'HarmonyOS Sans SC';
            src: url('./assets/fonts/HarmonyOS_SansSC_Regular.woff') format('woff'); 
            font-weight: 400;
            font-style: normal;
        }
        @font-face {
            font-family: 'HarmonyOS Sans SC';
            src: url('./assets/fonts/HarmonyOS_SansSC_Bold.woff') format('woff'); 
            font-weight: 700;
            font-style: normal;
        }

        /* =========================================
           DESIGN SETTINGS
           ========================================= */
        :root {
            /* メインカラー：紫 */
            --primary-color: #8407de; 
            /* ホバー時の青 */
            --hover-blue: #3b82f6; 
            
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-main: #ffffff;
            --text-muted: rgba(255, 255, 255, 0.7);
            --neon-cyan: #00f7ff;
            --neon-green: #00ff9d;
            /* エラー時の赤 */
            --neon-red: #ff2a2a; 
            
            /* 成功時の緑2色 */
            --success-green-light: #099c16;
            --success-green-dark: #047016;

            /* 背景画像設定 */
            --main-bg-image: url('');
        }

        /* 全要素に対して余白計算を統一 */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        /* HTMLとBODY両方に横スクロール禁止を適用 */
        html, body {
            margin: 0; 
            padding: 0; 
            width: 100%;
            overflow-x: hidden; 
        }

        body {
            min-height: 100vh;
            display: flex; 
            flex-direction: column; 
            align-items: center;
            color: var(--text-main);
            /* 画像がない場合の背景色を黒に指定 */
            background-color: #000000;
            background-image: var(--main-bg-image);
            background-size: cover; 
            background-position: center; 
            background-attachment: fixed;
        }

        /* =========================================
           LANGUAGE-SPECIFIC FONT STACKS (Global)
           ========================================= */
        
        html[lang="ja"] body, html[lang="ja"] input, html[lang="ja"] button, html[lang="ja"] select, html[lang="ja"] textarea {
            font-family: "HarmonyOS Sans", "Noto Sans JP", sans-serif;
        }
        html[lang="en"] body, html[lang="en"] input, html[lang="en"] button {
            font-family: "HarmonyOS Sans", sans-serif;
        }
        html[lang="zh"] body, html[lang="zh"] input, html[lang="zh"] button {
            font-family: "HarmonyOS Sans", "HarmonyOS Sans SC", "Microsoft YaHei", sans-serif;
        }
        html[lang="ko"] body, html[lang="ko"] input, html[lang="ko"] button {
            font-family: "HarmonyOS Sans", "Noto Sans KR", "Malgun Gothic", sans-serif;
        }
        html[lang="ru"] body, html[lang="ru"] input, html[lang="ru"] button {
            font-family: "HarmonyOS Sans", sans-serif;
        }

        /* コード入力欄は常に英語フォント優先 */
        .code-input {
            font-family: "HarmonyOS Sans", sans-serif !important;
        }

        /* =========================================
           ★日付表示エリア専用フォント設定
           数字はHarmonyOS、各言語文字はNoto等へフォールバック
           ========================================= */
        .news-date[lang="ja"] {
            font-family: 'HarmonyOS Sans', 'Noto Sans JP', sans-serif !important;
        }
        .news-date[lang="ko"] {
            font-family: 'HarmonyOS Sans', 'Noto Sans KR', sans-serif !important;
        }
        .news-date[lang="zh"] {
            font-family: 'HarmonyOS Sans', 'HarmonyOS Sans SC', sans-serif !important;
        }
        .news-date[lang="en"],
        .news-date[lang="ru"] {
            font-family: 'HarmonyOS Sans', sans-serif !important;
        }


        body::before {
            content: ''; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0, 0, 0, 0.5); 
            z-index: -1;
        }

        /* --- 共通コンポーネント --- */
        .glass-panel {
            background: var(--glass-bg); 
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border); 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* --- ヘッダー --- */
        header {
            width: 100%; 
            max-width: 1200px; 
            padding: 20px;
            display: flex; 
            /* 左揃えに設定 */
            justify-content: flex-start; 
            align-items: center; 
            margin-bottom: 40px;
        }
        .logo { 
            font-size: 24px; 
            font-weight: 700; 
            letter-spacing: 1px; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
        }
        
        /* 言語選択メニュー (フッター用) */
        .lang-select {
            background: rgba(0,0,0,0.4); 
            border: 1px solid var(--glass-border); 
            color: white;
            padding: 10px 20px; 
            border-radius: 30px; 
            outline: none; 
            cursor: pointer;
            font-family: inherit;
            font-size: 16px; 
            font-weight: bold;
            transition: background 0.3s;
            /* ★PC時は右下に絶対配置 */
            position: absolute;
            right: 20px;
            bottom: 20px;
        }
        .lang-select:hover {
            background: rgba(255,255,255,0.1);
        }
        .lang-select option { 
            background-color: #000; 
            color: white; 
        }

        /* --- メインコンテンツ --- */
        .container {
            width: 100%; 
            max-width: 1000px; 
            padding: 0 20px;
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            justify-content: center;
            /* ログイン前は非表示（JSで制御） */
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none; /* ログイン前はクリック不可 */
        }
        
        /* ログイン後に適用するクラス */
        .container.logged-in {
            opacity: 1;
            pointer-events: auto;
        }

        .grid-menu { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); 
            gap: 30px; 
            margin-bottom: 50px; 
        }
        .menu-card {
            border-radius: 24px; 
            padding: 40px 30px; 
            text-align: center;
            transition: transform 0.3s ease, background 0.3s ease; 
            cursor: default;
            display: flex; 
            flex-direction: column; 
            align-items: center;
            width: 100%;
        }
        .menu-card:hover { 
            transform: translateY(-10px); 
            background: rgba(255, 255, 255, 0.15); 
        }
        .card-icon-box {
            width: 80px; 
            height: 80px; 
            background: rgba(255,255,255,0.1); 
            border-radius: 50%;
            display: flex; 
            justify-content: center; 
            align-items: center; 
            margin-bottom: 20px; 
            color: #60a5fa;
        }
        .card-title { 
            font-size: 22px; 
            font-weight: bold; 
            margin: 0 0 10px 0; 
        }
        .card-desc { 
            font-size: 14px; 
            color: var(--text-muted); 
            margin: 0 0 25px 0; 
            line-height: 1.6; 
        }
        
        /* ★通常ボタン用アニメーション★ */
        @keyframes pulse-primary {
            0% { box-shadow: 0 0 10px rgba(132, 7, 222, 0.5), 0 0 5px rgba(132, 7, 222, 0.3); }
            50% { box-shadow: 0 0 25px rgba(132, 7, 222, 0.8), 0 0 15px rgba(132, 7, 222, 0.5); }
            100% { box-shadow: 0 0 10px rgba(132, 7, 222, 0.5), 0 0 5px rgba(132, 7, 222, 0.3); }
        }
        @keyframes pulse-blue-fast {
            0% { box-shadow: 0 0 15px rgba(59, 130, 246, 0.6), 0 0 10px rgba(59, 130, 246, 0.4); }
            50% { box-shadow: 0 0 35px rgba(59, 130, 246, 1.0), 0 0 20px rgba(59, 130, 246, 0.7); }
            100% { box-shadow: 0 0 15px rgba(59, 130, 246, 0.6), 0 0 10px rgba(59, 130, 246, 0.4); }
        }

        .btn-action {
            display: inline-flex; 
            align-items: center; 
            gap: 8px; 
            padding: 12px 30px; 
            border-radius: 50px;
            background: var(--primary-color);
            color: white; 
            text-decoration: none; 
            font-weight: bold; 
            font-size: 15px;
            border: 1px solid rgba(255,255,255,0.2); 
            cursor: pointer; 
            transition: background 0.3s, transform 0.2s;
            font-family: inherit; 
            justify-content: center;
            max-width: 100%;
            animation: pulse-primary 2s infinite ease-in-out;
        }
        
        .btn-action:hover { 
            background: var(--hover-blue); 
            transform: scale(1.05); 
            border-color: rgba(59, 130, 246, 0.8);
            animation: pulse-blue-fast 1.0s infinite ease-in-out; 
        }

        /* --- フッターレイアウト --- */
        footer { 
            padding: 20px; 
            font-size: 13px; 
            color: var(--text-muted); 
            text-align: center; 
            width: 100%; 
            word-break: break-all;
            /* PC: 相対配置で中の絶対配置の基準にする */
            position: relative;
            display: flex;
            justify-content: center; /* テキストは中央 */
            align-items: center;
            min-height: 80px; /* セレクトボックスが入る高さを確保 */
        }
        .footer-link { 
            color: white; 
            text-decoration: none; 
            border-bottom: 1px dotted white; 
        }

        /* --- 言語選択 オーバーレイ --- */
        #langSelectionOverlay {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0, 0, 0, 0.95); 
            z-index: 10001; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            transition: opacity 0.5s ease, visibility 0.5s ease;
            padding: 20px;
        }
        .lang-modal {
            width: 100%; 
            max-width: 500px; 
            padding: 40px; 
            text-align: center; 
            border-radius: 24px;
        }
        .lang-grid {
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 20px; 
            margin-top: 30px;
        }
        .lang-grid button:last-child:nth-child(odd) {
            grid-column: span 2;
        }

        /* --- ★管理者ログイン画面 --- */
        #adminLoginOverlay {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: #000000; /* 完全な黒背景 */
            z-index: 10000; /* 言語選択(10001)より下、メインより上 */
            display: none; /* 初期は非表示 */
            justify-content: center; 
            align-items: center; 
            padding: 20px;
            opacity: 0; 
            transition: opacity 0.5s ease;
        }
        
        .login-card {
            background: #111111;
            border: 1px solid #333;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 550px; /* ★幅を広げました */
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            position: relative;
        }

        .login-icon {
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .login-title {
            font-size: 24px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .login-desc {
            font-size: 13px;
            color: #888;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .login-label {
            display: block;
            text-align: left;
            font-size: 12px;
            color: #aaa;
            margin-bottom: 8px;
            margin-left: 5px;
        }

        .login-input {
            width: 100%;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 14px 16px;
            color: white;
            font-size: 16px;
            outline: none;
            margin-bottom: 20px;
            transition: border-color 0.3s;
            font-family: inherit;
        }
        
        .login-input:focus {
            border-color: var(--primary-color);
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: #8407de; /* 指定の紫 */
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 0 15px rgba(132, 7, 222, 0.4);
            margin-top: 10px;
        }

        .login-btn:hover {
            background: #9d2ae6;
            box-shadow: 0 0 25px rgba(132, 7, 222, 0.6);
        }
        
        .login-btn:disabled {
            opacity: 0.7;
            cursor: wait;
        }

        /* ログイン画面内の言語選択（右上・変更可能） */
        .login-lang-select {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #222;
            color: #aaa;
            border: 1px solid #333;
            border-radius: 20px;
            padding: 5px 10px;
            font-size: 12px;
            outline: none;
            cursor: pointer;
            font-family: inherit;
            text-align: center;
            transition: all 0.2s;
        }
        .login-lang-select:hover {
            background: #333;
            color: white;
            border-color: #555;
        }
        /* オプションの背景色 */
        .login-lang-select option {
            background: #111;
            color: white;
        }

        /* --- モーダル (汎用) --- */
        .modal-overlay {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0, 0, 0, 0.6); 
            backdrop-filter: blur(8px);
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 2000;
            opacity: 0; 
            visibility: hidden; 
            transition: opacity 0.4s ease, visibility 0.4s ease;
            padding: 10px;
        }
        .modal-overlay.active { 
            opacity: 1; 
            visibility: visible; 
        }

        .modal-container {
            width: 100%; 
            max-width: 480px; 
            border-radius: 24px; 
            padding: 40px; 
            text-align: center; 
            position: relative; 
            transform: scale(0.9); 
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            max-height: 90vh; 
            overflow-y: auto;
            display: flex; 
            flex-direction: column;
        }
        .modal-overlay.active .modal-container { 
            transform: scale(1); 
        }
        
        /* ------------------------------------------------------------- */
        /* ★アニメーション定義★ */
        /* ------------------------------------------------------------- */
        
        /* 1. 緑色アニメーション (デフォルト) */
        @keyframes anim-green {
            0% {
                border-color: var(--success-green-light);
                box-shadow: 0 0 15px rgba(9, 156, 22, 0.4), 0 0 5px rgba(9, 156, 22, 0.2);
            }
            50% {
                border-color: var(--neon-green); 
                box-shadow: 0 0 40px rgba(9, 156, 22, 0.8), 0 0 20px rgba(9, 156, 22, 0.5);
            }
            100% {
                border-color: var(--success-green-light);
                box-shadow: 0 0 15px rgba(9, 156, 22, 0.4), 0 0 5px rgba(9, 156, 22, 0.2);
            }
        }

        /* 2. 青紫ミックスアニメーション (ホバー時 - メインボックス枠線用) */
        @keyframes anim-box-blue-purple {
            0% {
                border-color: #0066ff;
                box-shadow: 0 0 15px rgba(0, 102, 255, 0.4), 0 0 5px rgba(0, 102, 255, 0.2);
            }
            50% {
                border-color: #aa00ff;
                box-shadow: 0 0 25px rgba(170, 0, 255, 0.6), 0 0 10px rgba(170, 0, 255, 0.3);
            }
            100% {
                border-color: #0066ff;
                box-shadow: 0 0 15px rgba(0, 102, 255, 0.4), 0 0 5px rgba(0, 102, 255, 0.2);
            }
        }

        /* 3. 青紫ミックスアニメーション (ホバー時 - バッジ & ボタン用) */
        @keyframes anim-badge-blue-purple {
            0% {
                border-color: #0066ff;
                background: rgba(0, 102, 255, 0.15);
                box-shadow: 0 0 15px rgba(0, 102, 255, 0.4);
            }
            50% {
                border-color: #aa00ff;
                background: rgba(170, 0, 255, 0.15);
                box-shadow: 0 0 25px rgba(170, 0, 255, 0.6);
            }
            100% {
                border-color: #0066ff;
                background: rgba(0, 102, 255, 0.15);
                box-shadow: 0 0 15px rgba(0, 102, 255, 0.4);
            }
        }
        
        /* 4. アイコン(SVG)用 */
        @keyframes anim-svg-mixed {
            0% { filter: drop-shadow(0 0 5px rgba(0, 102, 255, 0.8)); }
            50% { filter: drop-shadow(0 0 5px rgba(170, 0, 255, 0.8)); }
            100% { filter: drop-shadow(0 0 5px rgba(0, 102, 255, 0.8)); }
        }


        /* --- モーダル設定 (通常時：緑) --- */
        .modal-container.wide-mode {
            max-width: 900px;
            padding: 0;
            display: flex;
            flex-direction: row;
            overflow: hidden;
            border: 2px solid var(--success-green-light);
            /* デフォルトは緑アニメーション */
            animation: anim-green 3s infinite ease-in-out;
            transition: border-color 0.3s ease;
        }
        
        /* --- モーダル設定 (ホバー連動時：青紫) --- */
        #modalContainer.wide-mode.sync-blue-mode {
            /* !importantで確実に適用 */
            animation: anim-box-blue-purple 3s infinite ease-in-out !important;
            border-color: #0066ff !important; /* 初期値を鮮やかな青に */
        }

        .modal-close {
            position: absolute; 
            top: 20px; 
            right: 20px; 
            cursor: pointer; 
            color: rgba(255,255,255,0.6); 
            transition: color 0.2s; 
            z-index: 100;
        }
        .modal-close:hover { 
            color: white; 
        }

        #inputPhase { 
            width: 100%; 
        }
        .modal-title { 
            font-size: 26px; 
            margin-bottom: 10px; 
            font-weight: bold; 
            word-break: break-all; 
        }
        .modal-sub { 
            font-size: 14px; 
            color: var(--text-muted); 
            margin-bottom: 30px; 
        }
        .input-wrapper { 
            margin-bottom: 25px; 
        }
        
        .code-input {
            width: 100%; 
            box-sizing: border-box; 
            background: rgba(0, 0, 0, 0.3); 
            border: 1px solid var(--glass-border); 
            border-radius: 12px; 
            padding: 16px;
            color: white; 
            font-size: 18px; 
            text-align: center; 
            letter-spacing: 0em; 
            outline: none; 
            transition: all 0.3s; 
            text-transform: uppercase;
        }
        .code-input:focus { 
            border-color: var(--primary-color); 
            box-shadow: 0 0 20px rgba(132, 7, 222, 0.5); 
        }
        
        .btn-confirm {
            width: 100%; 
            padding: 16px; 
            border-radius: 12px; 
            background: var(--primary-color); 
            color: white; 
            border: none; 
            font-size: 16px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.2s; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 56px; 
            box-sizing: border-box; 
            font-family: inherit; 
            border: 1px solid rgba(255,255,255,0.2);
            animation: pulse-primary 2s infinite ease-in-out;
        }
        
        .btn-confirm:hover { 
            background: var(--hover-blue); 
            transform: translateY(-2px); 
            border-color: rgba(59, 130, 246, 0.8);
            animation: pulse-blue-fast 1.0s infinite ease-in-out; 
        }
        
        .btn-confirm:disabled { 
            background: var(--primary-color); 
            opacity: 0.8; 
            cursor: wait; 
            transform: none; 
            animation: none; 
            box-shadow: none;
        }

        /* --- エラー時の赤発光クラス --- */
        .btn-confirm.error-glow {
            border-color: var(--neon-red) !important;
            box-shadow: 0 0 25px rgba(255, 42, 42, 0.8) !important;
            animation: none !important; 
            background-color: rgba(255, 42, 42, 0.7) !important; 
            color: white !important; 
        }
        .code-input.error-glow {
            border-color: var(--neon-red) !important;
            box-shadow: 0 0 25px rgba(255, 42, 42, 0.8) !important;
        }
        /* 管理者ログイン用のエラー表示 */
        .login-input.error-border {
            border-color: var(--neon-red) !important;
            box-shadow: 0 0 10px rgba(255, 42, 42, 0.5) !important;
        }

        .modal-error-border {
            border: 2px solid var(--neon-red) !important;
            box-shadow: 0 0 30px rgba(255, 42, 42, 0.8) !important;
            transition: all 0.3s;
        }
        
        #successPhase { 
            display: none; 
            width: 100%; 
            height: 100%; 
        }
        .success-layout { 
            display: flex; 
            width: 100%; 
            min-height: 500px; 
        }
        .success-left { 
            flex: 1; 
            background-color: rgba(0,0,0,0.3); 
            position: relative; 
            display: none; 
        }
        .success-left img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            position: absolute; 
            top: 0; 
            left: 0; 
        }
        .success-right { 
            flex: 1.2; 
            padding: 40px; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: flex-start; 
            text-align: left; 
        }

        /* ★成功バッジ（チェックマーク）の設定 */
        .success-tag {
            background: rgba(9, 156, 22, 0.2);
            border: 2px solid var(--success-green-light);
            color: var(--neon-green);
            padding: 8px 16px; 
            border-radius: 30px; 
            font-size: 14px; 
            font-weight: bold; 
            margin-bottom: 20px; 
            display: inline-flex; 
            align-items: center; 
            gap: 8px;
            text-shadow: 0 0 8px rgba(0, 255, 157, 0.6); 
            font-family: inherit;
            white-space: nowrap;
            /* 通常時は緑アニメーション */
            animation: anim-green 3s infinite ease-in-out;
            transition: all 0.3s ease;
        }
        .success-tag svg { 
            filter: drop-shadow(0 0 5px rgba(0, 255, 157, 0.8)); 
            flex-shrink: 0; 
            transition: all 0.3s ease; 
        }

        /* ★★★ 連動モード適用：バッジ（枠線アニメーション + 文字色固定） ★★★ */
        #modalContainer.wide-mode.sync-blue-mode .success-tag {
            /* 枠線と背景のアニメーション（青⇔紫） */
            animation: anim-badge-blue-purple 3s infinite ease-in-out !important;
            /* 文字色は鮮やかな青固定（点滅させない） */
            color: #0066ff !important;
            text-shadow: none !important;
            border-color: #0066ff !important;
        }
        /* アイコンも青固定（点滅させない） */
        #modalContainer.wide-mode.sync-blue-mode .success-tag svg {
             filter: drop-shadow(0 0 5px rgba(0, 102, 255, 0.8)) !important;
             animation: none !important;
        }
        
        .success-title-main { 
            font-size: 28px; 
            font-weight: bold; 
            margin-bottom: 20px; 
            line-height: 1.3; 
        }
        .success-info-box { 
            background: rgba(255,255,255,0.05); 
            border-radius: 12px; 
            padding: 20px; 
            width: 100%; 
            box-sizing: border-box; 
            margin-bottom: 25px; 
        }
        .success-label { 
            font-size: 12px; 
            color: var(--text-muted); 
        }
        
        /* ★コンテンツ名テキスト */
        .success-content { 
            font-size: 18px; 
            font-weight: bold; 
            margin-top: 5px; 
            /* 通常時：緑色で光る */
            color: var(--neon-green); 
            word-break: break-all;
            text-shadow: 0 0 5px rgba(0, 255, 157, 0.5); 
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }

        /* ★★★ 連動モード適用：コンテンツ名 ★★★ */
        /* 鮮やかな青色(#0066ff)にするが、光らせない（text-shadow: none） */
        #modalContainer.wide-mode.sync-blue-mode .success-content {
            color: #0066ff !important;
            text-shadow: none !important;
            animation: none !important;
        }

        .success-extra { 
            font-size: 14px; 
            margin-top: 10px; 
            color: #ddd; 
            white-space: pre-wrap; 
            border-top: 1px solid rgba(255,255,255,0.1); 
            padding-top: 10px;
        }

        .btn-group { 
            display: flex; 
            gap: 15px; 
            width: 100%; 
            flex-wrap: wrap; 
        }
        
        /* ★成功時のダウンロードボタン */
        #successDownloadBtn { 
            flex: 2; 
            text-decoration: none; 
            text-align: center; 
            min-width: 140px;
            background: #099c16 !important;
            border: 2px solid var(--success-green-light) !important;
            /* 通常時は緑アニメーション */
            animation: anim-green 3s infinite ease-in-out !important;
        }
        #successDownloadBtn:hover {
            background: var(--hover-blue) !important;
            /* ホバー時：青紫ミックスアニメーション（枠線と影） */
            animation: anim-badge-blue-purple 3s infinite ease-in-out !important;
            transform: translateY(-2px);
            border-color: #0066ff !important;
        }

        #modalCloseSub {
            flex: 1; 
            background: transparent; 
            border: 2px solid rgba(255,255,255,0.3); 
            color: white;
            padding: 16px; 
            border-radius: 12px; 
            font-size: 16px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.2s; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 56px; 
            box-sizing: border-box; 
            font-family: inherit; 
            min-width: 100px;
        }
        #modalCloseSub:hover { 
            background: rgba(255,255,255,0.1); 
            border-color: #fff; 
        }

        /* --- ★サポートモーダル専用スタイル (大幅改修) --- */
        .modal-container.wide-support-mode {
            max-width: 900px; /* PC幅確保 */
            padding: 30px; /* 余白調整 */
        }

        .support-grid {
            display: grid;
            gap: 10px; /* ★ボックス間の隙間を大幅に縮小 */
            margin-bottom: 20px;
            width: 100%;
        }

        /* PC: 5列 */
        @media (min-width: 769px) {
            .support-grid { 
                grid-template-columns: repeat(5, 1fr); 
            }
        }

        /* サポートアイテム(ボックス) */
        .support-item {
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: space-between;
            padding: 20px 10px; 
            background: rgba(255,255,255,0.05); 
            border: 1px solid var(--glass-border);
            border-radius: 16px; 
            color: white; 
            transition: 0.3s; 
            /* ★Closeボタンを消した分、高さを増やして縦長に (200px -> 280px) */
            height: 280px; 
            text-align: center; 
            width: 100%;
        }
        
        /* FontAwesomeアイコン */
        .support-item i { 
            font-size: 48px; 
            margin-top: 20px; /* 上部の余白も少し調整 */
            margin-bottom: 10px; 
            /* 色はHTMLのstyleタグで本物の色を指定し、CSSでは変更しない */
            transition: transform 0.3s; 
        }
        .support-item span { 
            font-size: 14px; 
            font-weight: bold; 
            margin-bottom: auto; 
        }
        
        .support-item:hover {
            background: rgba(255,255,255,0.15); 
            transform: translateY(-5px); 
            border-color: rgba(255, 255, 255, 0.4); 
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1); 
        }
        /* ホバー時のアイコン：色は変えず、少し拡大のみ */
        .support-item:hover i { 
            transform: scale(1.1); 
        }

        /* 問い合わせボタン (ボックス内) */
        .btn-inquiry-small {
            margin-bottom: 20px; /* 下部の余白調整 */
            display: inline-block; 
            padding: 10px 20px; 
            border-radius: 30px; 
            background: rgba(255,255,255,0.1); 
            color: white; 
            text-decoration: none; 
            font-size: 13px; 
            font-weight: bold; 
            border: 1px solid rgba(255,255,255,0.3); 
            transition: all 0.2s; 
            width: 100%; 
            max-width: 120px; 
            cursor: pointer;
            text-align: center;
        }
        .btn-inquiry-small:hover {
            background: var(--primary-color); 
            border-color: var(--primary-color); 
            box-shadow: 0 0 10px rgba(132, 7, 222, 0.5); 
        }

        /* --- モバイル専用調整 --- */
        @media (max-width: 768px) {
            header { 
                padding: 15px; 
                margin-bottom: 20px; 
            }
            .logo { 
                font-size: 20px; 
            }
            .container { 
                padding: 0 15px; /* ここが15px */
            }
            .grid-menu { 
                gap: 20px; 
            }

            /* スマホ時のフッター設定 (Language Top/Right, Text Bottom/Center) */
            footer {
                flex-direction: column;
                justify-content: center;
                gap: 10px;
                padding-bottom: 30px; /* 少し余白確保 */
            }
            .lang-select {
                position: static; /* 絶対配置解除 */
                order: -1; /* 順序を一番上に */
                align-self: flex-end; /* 右寄せ */
                margin-right: 10px; /* 右端の余白微調整 */
                margin-bottom: 0;
            }
            .footer-content {
                order: 1; /* 順序を下に */
                width: 100%; /* 幅確保で中央揃えを確実に */
                text-align: center;
            }

            .modal-container.wide-mode { 
                flex-direction: column; 
                max-width: 100%; 
                overflow-y: auto; 
                height: auto; 
            }
            .success-layout { 
                flex-direction: column; 
            }
            .success-left { 
                width: 100%; 
                min-height: 200px; 
                display: block; 
                position: relative; 
            }
            .success-left img { 
                position: relative; 
                height: 200px; 
            }
            .success-right { 
                padding: 30px 20px; 
                align-items: center; 
                text-align: center; 
                width: 100%; 
            }
            .success-info-box { 
                text-align: left; 
            }
            .success-right { 
                align-items: stretch; 
            }
            .lang-grid { 
                grid-template-columns: 1fr; 
            }
            .lang-grid button:last-child:nth-child(odd) { 
                grid-column: span 1; 
            }

            /* ★修正: スマホでの横スクロール対応とPC型維持 */
            .support-grid {
                /* GridをやめてFlexboxにして横並びスクロールにする */
                display: flex !important; 
                flex-direction: row;
                overflow-x: auto; /* 横スクロール許可 */
                gap: 15px; /* ボックス間の余白 */
                
                /* ★重要: パディングを追加してホバー時の見切れを防止 */
                padding: 20px 10px; 
                
                /* ★修正: マージンをコンテナのパディング(-15px)と合わせる */
                margin: 0 -15px; 
                
                /* ★修正: 計算式をマージンに合わせて修正 */
                width: calc(100% + 30px);
                
                justify-content: flex-start; /* 左から並べる */
                
                /* スクロールを滑らかにする */
                -webkit-overflow-scrolling: touch;
                scroll-snap-type: x mandatory;
            }
            
            /* 個別の列指定を解除 */
            .support-item:nth-child(n) {
                grid-column: auto !important;
            }

            /* ★ボックスの形状設定（PCと同じ形を維持する） */
            .support-item { 
                height: 280px; /* PCと同じ高さ */
                min-width: 160px; /* ★重要：つぶれないように最小幅を固定 */
                width: 160px; /* 幅も固定 */
                flex: 0 0 auto; /* フレックス内で縮小しないようにする */
                scroll-snap-align: center; /* スクロール時に中央に吸着 */
                padding: 20px 10px; /* 余白もPCと同じに */
            }
            
            .support-item i { 
                font-size: 48px; /* アイコンサイズもPCと同じ */
            }
            .support-item span { 
                font-size: 14px; /* 文字サイズもPCと同じ */
            }
            
            /* ボタンがはみ出さないように調整 */
            .btn-inquiry-small {
                width: 90%; /* 幅を少し狭めて収まりよくする */
                font-size: 12px;
                white-space: nowrap;
                margin-bottom: 20px;
            }
            .login-card {
                /* カードの横幅の余白を減らして文字スペースを確保 */
                padding: 30px 15px !important;
                width: 90%;
            }

            .login-title {
                /* スマホでは文字サイズを小さくする (PCは24px) */
                font-size: 18px !important;
                
                /* 強制的に改行させない指定 */
                /* white-space: nowrap;  ← 【削除】タイトルが切れるのを防ぐため */
            }
        }

        #statusContainer { 
            margin-top: 15px; 
            font-size: 14px; 
        }
        .error-msg { 
            color: #ff6b6b; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 5px; 
        }

        /* --- 近未来的なローディングスピナー --- */
        .cyber-spinner {
            position: relative;
            width: 26px;
            height: 26px;
            display: inline-block;
            margin-right: 12px;
            border-radius: 50%;
            animation: pulse-core 1.5s ease-in-out infinite alternate;
        }

        .cyber-spinner::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            border: 2px solid transparent;
            border-top-color: var(--neon-cyan);
            border-bottom-color: var(--neon-cyan);
            border-radius: 50%;
            animation: spin-cyber 0.8s linear infinite;
            filter: drop-shadow(0 0 4px var(--neon-cyan));
        }

        .cyber-spinner::after {
            content: '';
            position: absolute;
            top: 4px; left: 4px;
            width: calc(100% - 8px);
            height: calc(100% - 8px);
            border: 2px solid transparent;
            border-top-color: #ffffff;
            border-right-color: var(--primary-color);
            border-radius: 50%;
            animation: spin-cyber-reverse 1.8s linear infinite;
            filter: drop-shadow(0 0 3px var(--primary-color));
        }

        @keyframes pulse-core {
            0% { box-shadow: 0 0 2px var(--primary-color), inset 0 0 2px var(--neon-cyan); }
            100% { box-shadow: 0 0 10px var(--neon-cyan), inset 0 0 8px var(--primary-color); }
        }
        @keyframes spin-cyber { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes spin-cyber-reverse { 0% { transform: rotate(0deg); } 100% { transform: rotate(-360deg); } }


        .loading-dots::after {
            display: inline-block; animation: dot-steps 1.5s infinite steps(1);
            content: '.'; width: 1.2em; text-align: left;
        }
        @keyframes dot-steps { 0% { content: '.'; } 33% { content: '..'; } 67% { content: '...'; } }

        /* =========================================
           ★ニュースリスト用スタイル (最終修正版)
           ========================================= */
        
        /* ニュース表示エリアのコンテナ（黒いボックスは残す） */
        .news-container {
            text-align: left;
            /* 黒っぽい背景を維持 */
            background: rgba(0, 0, 0, 0.3) !important;
            /* padding: 20px;  <-- ここを変更 */
            padding: 20px 20px 10px 20px; /* 下の余白を減らす */
            border-radius: 16px;
            margin-bottom: 0 !important; /* ★変更: 下の余白をなくす */
            max-height: 400px;
            overflow-y: auto;
            /* 枠線は薄い白系で維持 */
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        /* ニュースモーダル全体の余白調整 (閉じるボタン削除に伴い) */
        #newsModal .modal-container {
            padding-bottom: 20px !important; /* コンテナの下部パディングを30px->20pxへ調整 */
        }

        .news-container::-webkit-scrollbar { width: 6px; }
        .news-container::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 3px; }
        .news-container::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.3); border-radius: 3px; }

        #newsList {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        /* ニュースアイテム (個別の紫ボックスは完全に削除) */
        .news-item {
            /* ★重要：背景色、枠線、影をすべて削除（透明） */
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            
            padding: 10px 0; /* 上下余白のみ確保 */
            margin-bottom: 15px; /* アイテム間の距離 */
            display: flex;
            flex-direction: column;
            gap: 5px;
            position: relative;
            overflow: visible;
        }
        
        /* ★追加: 最後のアイテムの下マージンを削除して余白を詰める */
        .news-item:last-child {
            margin-bottom: 0 !important;
        }

        /* ホバー時も何も表示させない */
        .news-item:hover {
            background: transparent !important;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* 左端のアクセントラインも削除 */
        .news-item::before {
            display: none !important;
        }

        /* --- 日付デザイン修正 --- */
        .news-date {
            color: #ffffff;      /* 白色 */
            font-size: 20px;     /* 本文(14px)より大きく */
            font-weight: bold;
            margin-bottom: 5px;
            letter-spacing: 0.5px;
            text-align: left;    /* 左寄せ */
            display: block;
        }

       /* ニュース本文 */
        .news-content-text {
            font-size: 14px;
            line-height: 1.6;
            color: #f0f0f0;
            padding-left: 0;     /* 左端 */
            white-space: pre-wrap; /* ★この行を追加：改行コードを反映させる */
        }
        /* =========================================
           ★スマホ表示修正用 (追加コード)
           ========================================= */
        @media (max-width: 768px) {
            /* 1. アクティベーション完了画面のタイトル「有効化されたコンテンツ」を小さくする */
            .success-title-main {
                font-size: 20px; /* PCの28pxから20pxへ縮小 */
                line-height: 1.4;
                margin-bottom: 15px;
            }

            /* 2. ニュースモーダルの余白（パディング）を小さくする */
            
            /* (A) 外側のガラスパネルの余白 */
            #newsModal .modal-container {
                /* 上下20px, 左右15px に縮小 (PCは40px) */
                padding: 20px 15px !important; 
                width: 95%; /* 横幅を画面いっぱいに近づける */
            }

            /* (B) 内側の黒い背景部分の余白 */
            .news-container {
                /* 上15px, 右10px, 下10px, 左10px に縮小 (PCは20px) */
                padding: 15px 10px 10px 10px !important;
            }
        }
            /* =========================================
           ★PCニュース表示用 (文字数に合わせて幅自動調整)
           ========================================= */
        @media (min-width: 769px) {
            #newsModal .modal-container.news-wide-mode {
                /* 幅を「中身（文字量）に合わせる」設定に変更 */
                width: fit-content !important;
                width: -moz-fit-content !important; /* Firefox用 */
                
                /* 最小・最大の制限 */
                min-width: 480px;            /* 文字が少なくてもこれより小さくならない（読み込み時と同じ幅） */
                max-width: 900px !important; /* 文字が多くてもこれ以上は広がらない */
                
                /* アニメーション */
                transition: all 0.4s ease; 
            }

            /* コンテナ自体が縮んだ時に中身が崩れないようにする */
            .news-container {
                width: 100%;
            }
            
            /* 長すぎる単語があっても枠内に収める */
            .news-content-text {
                word-break: break-word;
            }
        }
    </style>
</head>
<body>

    <div id="langSelectionOverlay">
        <div class="glass-panel lang-modal">
            <div class="logo" style="justify-content:center; margin-bottom:20px;">
                <i data-lucide="globe" size="32" style="color: #9347FF;"></i>
            </div>
            <h2 style="font-size: 24px; margin-bottom: 10px;">Select Language</h2>
            <p style="color:rgba(255,255,255,0.7); font-size:14px;">言語を選択してください</p>
            
            <div class="lang-grid">
                <button class="btn-action" onclick="setInitialLanguage('ja')">日本語</button>
                <button class="btn-action" onclick="setInitialLanguage('en')">English</button>
                <button class="btn-action" onclick="setInitialLanguage('zh')">中文</button>
                <button class="btn-action" onclick="setInitialLanguage('ko')">한국어</button>
                <button class="btn-action" onclick="setInitialLanguage('ru')">Русский</button>
            </div>

            <div style="margin-top: 30px; font-size: 12px; color: rgba(255,255,255,0.5); opacity:0.8;">
                Enforcement Administrator:kiryu-sensya
            </div>
        </div>
    </div>

    <div id="adminLoginOverlay">
        <div class="login-card">
            <select id="loginLangSwitcher" class="login-lang-select">
                <option value="ja">日本語</option>
                <option value="en">English</option>
                <option value="zh">中文</option>
                <option value="ko">조선말</option>
                <option value="ru">Русский</option>
            </select>

            <div class="login-icon">
                <i data-lucide="user-round-cog" size="70"></i>
            </div>
            <h2 class="login-title" data-translate="login_title">SYSTEM LOGIN</h2>
            <p class="login-desc" data-translate="login_desc">アクセス権限を確認します。<br>IDとパスワードを入力してください。</p>
            
            <label class="login-label" data-translate="login_label_user">User ID</label>
            <input type="text" id="loginUser" class="login-input" placeholder="ユーザー名">
            
            <label class="login-label" data-translate="login_label_pass">Password</label>
            <input type="password" id="loginPass" class="login-input" placeholder="パスワード">
            
            <button class="login-btn" id="btnLoginAction" data-translate="login_btn">ログイン</button>
        </div>
    </div>

    <header>
        <div class="logo"><i data-lucide="user-round" style="color: #8407de;"></i>kiryu-sensya</div>
    </header>

    <div class="container" id="mainContainer">
        <div class="grid-menu">
            <div class="menu-card glass-panel">
                <div class="card-icon-box"><i data-lucide="key" size="40"></i></div>
                <h3 class="card-title" data-translate="card1_title">アクティベーション</h3>
                <p class="card-desc" data-translate="card1_desc">コードを使用して<br>コンテンツをアンロック</p>
                <button id="btnOpenModal" class="btn-action">
                    <span data-translate="card1_btn">コードを使用</span><i data-lucide="download" size="16"></i>
                </button>
            </div>

            <div class="menu-card glass-panel">
                <div class="card-icon-box" style="color: #f472b6;"><i data-lucide="newspaper" size="40"></i></div>
                <h3 class="card-title" data-translate="card2_title">ニュース</h3>
                <p class="card-desc" data-translate="card2_desc">このサイトに関する<br>アップデート情報</p>
                <button id="btnOpenNews" class="btn-action">
                    <span data-translate="card2_btn">確認する</span><i data-lucide="circle-fading-arrow-up" size="16"></i>
                </button>
            </div>

            <div class="menu-card glass-panel">
                <div class="card-icon-box" style="color: #34d399;"><i data-lucide="message-circle" size="40"></i></div>
                <h3 class="card-title" data-translate="card3_title">サポート</h3>
                <p class="card-desc" data-translate="card3_desc">コードが無効な場合などは<br>こちらからご連絡ください</p>
                <button id="btnOpenSupport" class="btn-action">
                    <span data-translate="card3_btn">問い合わせ</span><i data-lucide="arrow-up-right" size="16"></i>
                </button>
            </div>
        </div>
    </div>

    <footer>
        <div style="text-align: center;">
            <span data-translate="footer_admin">Enforcement Administrator</span>: 
            <a href="https://developer-kiryu10.vercel.app/" target="_blank" class="footer-link">kiryu-sensya</a>
            <br>
            <span style="opacity: 0.5; font-size: 11px;">© 2019-2026 kiryu-sensya. All rights reserved.</span>
        </div>
        <select id="languageSwitcher" class="lang-select glass-panel">
            <option value="ja" selected>日本語</option>
            <option value="en">English</option>
            <option value="zh">中文</option>
            <option value="ko">조선말</option>
            <option value="ru">Русский</option>
        </select>
    </footer>

    <div id="authModal" class="modal-overlay">
        <div class="modal-container glass-panel" id="modalContainer">
            <div class="modal-close" id="modalCloseBtn"><i data-lucide="x"></i></div>
            <div id="inputPhase">
                <h2 class="modal-title" data-translate="modal_title">アクティベーション</h2>
                <p class="modal-sub" data-translate="modal_sub">コードを入力してください。</p>
                <div class="input-wrapper">
                    <input type="text" id="activationCode" class="code-input" placeholder="コードを入力" autocomplete="off">
                </div>
                <button id="btnConfirm" class="btn-confirm" data-translate="modal_btn_auth">認証する</button>
                <div id="statusContainer"></div>
            </div>
            <div id="successPhase">
                <div class="success-layout">
                    <div class="success-left" id="successLeftCol"><img id="successImage" src="" alt="Result Image"></div>
                    <div class="success-right">
                        <div class="success-tag"><i data-lucide="circle-check-big" size="23"></i><span data-translate="success_badge">コードが認証されました。</span></div>
                        <h2 class="success-title-main" data-translate="success_main_title">有効化されたコンテンツ</h2>
                        <div class="success-info-box">
                            <div class="success-label" data-translate="success_label_name">コンテンツ名称</div>
                            <div class="success-content" id="successTitle">Loading...</div>
                            <div class="success-extra" id="successExtraInfo"></div>
                        </div>
                        <div class="btn-group">
                            <button id="modalCloseSub" data-translate="btn_close">閉じる</button>
                            <a href="#" id="successDownloadBtn" class="btn-confirm" data-translate="btn_download">ダウンロード</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="newsModal" class="modal-overlay">
        <div class="modal-container glass-panel">
            <div class="modal-close" id="newsCloseX"><i data-lucide="x"></i></div>
            <h2 class="modal-title" style="margin-bottom: 20px;" data-translate="news_title">最新情報</h2>
            
            <div class="news-container">
                <h3 id="newsHeader" style="display: none; font-size: 16px; color: white; margin: 0 0 15px 0; align-items:center; gap:6px;">
                    <span style="color: #ff2a2a; font-size: 18px;">●</span>
                    <span data-translate="news_label">変更ログ</span>
                </h3>
                
                <ul id="newsList">
                    <li style="text-align:center; color:#888; padding:20px;">Loading...</li>
                </ul>
            </div>
            
            </div>
    </div>

    <div id="supportModal" class="modal-overlay">
        <div class="modal-container glass-panel wide-support-mode">
            <div class="modal-close" id="supportCloseX"><i data-lucide="x"></i></div>
            <h2 class="modal-title" style="margin-bottom: 20px;" data-translate="support_modal_title">サポート</h2>
            <div class="support-grid">
                <div class="support-item"><i class="fa-brands fa-playstation" style="color: #00439C;"></i><span>PlayStation</span><a href="#" class="btn-inquiry-small" data-translate="btn_inquiry">問い合わせ</a></div>
                <div class="support-item"><i class="fa-brands fa-xbox" style="color: #107C10;"></i><span>Xbox</span><a href="#" class="btn-inquiry-small" data-translate="btn_inquiry">問い合わせ</a></div>
                <div class="support-item"><i class="fa-brands fa-discord" style="color: #5865F2;"></i><span>Discord</span><a href="#" class="btn-inquiry-small" data-translate="btn_inquiry">問い合わせ</a></div>
                <div class="support-item"><i class="fa-brands fa-github" style="color: #ffffff;"></i><span>GitHub</span><a href="#" class="btn-inquiry-small" data-translate="btn_inquiry">問い合わせ</a></div>
                <div class="support-item"><i class="fa-brands fa-instagram" style="color: #E4405F;"></i><span>Instagram</span><button id="btnOpenInstagram" class="btn-inquiry-small" data-translate="btn_inquiry">問い合わせ</button></div>
            </div>
        </div>
    </div>

    <div id="instagramAuthModal" class="modal-overlay">
        <div class="modal-container glass-panel" id="instagramModalContainer">
            <div class="modal-close" id="instagramCloseBtn"><i data-lucide="x"></i></div>
            <div id="instaInputPhase">
                <h2 class="modal-title" style="margin-bottom:10px;" data-translate="insta_title">Instagram Inquiry</h2>
                <p class="modal-sub" style="margin-bottom:30px;" data-translate="insta_sub">ユーザーID(@xxx)を入力してください</p>
                <div class="input-wrapper">
                    <input type="text" id="instaInput" class="code-input" placeholder="@username" autocomplete="off" style="text-transform:none;" data-translate-placeholder="insta_placeholder">
                </div>
                <button id="instaConfirm" class="btn-confirm" data-translate="insta_btn">認証する</button>
                <div id="instaStatusContainer" style="margin-top:15px; font-size:14px;"></div>
            </div>
            <div id="instaSuccessPhase" style="display:none;">
                <div class="success-tag"><i data-lucide="circle-check-big" size="23"></i><span>Verified</span></div>
                <p id="instaSuccessMessage" style="margin-bottom:20px; font-size:16px; line-height:1.5;"></p>
                <a href="https://www.instagram.com/kiryu_sensya" target="_blank" id="instaSuccessButton" class="btn-confirm" style="text-decoration:none;" data-translate="insta_success_btn">Open Instagram</a>
            </div>
        </div>
    </div>

<script>
    lucide.createIcons();
    // ▼ あなたのGASのURLに書き換えてください
    const GAS_API_URL = "https://script.google.com/macros/s/AKfycby-euxYGL5-ov5Lb-Q_7HFcLvIgfTf354FQAqT0bOsTJFo7l3NDISmFS64dS8wr-DxScA/exec"; 
    let CURRENT_LANG = "ja"; 

    // --- 翻訳データ (Instagram対応版) ---
    const TRANSLATIONS = {
        ja: {
            card1_title: "アクティベーション", card1_desc: "コードを使用して<br>コンテンツをアンロック", card1_btn: "コードを使用",
            card2_title: "ニュース", card2_desc: "このサイトに関する<br>アップデート情報", card2_btn: "確認する",
            card3_title: "サポート", card3_desc: "コードが無効な場合などは<br>こちらからご連絡ください", card3_btn: "問い合わせ",
            modal_title: "アクティベーション", modal_sub: "コードを入力してください。",
            modal_placeholder: "コードを入力", modal_btn_auth: "認証する",
            msg_verifying: "確認中",
            msg_invalid: "このコードは無効です。", msg_used: "このコードは既に使用済みです。", msg_error: "通信エラーが発生しました。",
            success_badge: "コードが認証されました。", success_main_title: "有効化されたコンテンツ",
            success_label_name: "コンテンツ名称", btn_close: "閉じる", btn_download: "ダウンロード",
            news_title: "最新情報", news_label: "変更ログ", 
            news_loading: "更新を確認中",
            support_modal_title: "何かお困りですか？ ", btn_inquiry: "利用不可",
            footer_admin: "システム管理者",
            login_title: "システム管理者ログイン", login_desc: "アクセス権限を確認します。<br>身分証明書番号とパスワードを入力してください。",
            login_label_user: "身分証明書番号 ", login_label_pass: "パスワード",
            login_btn: "ログイン", login_btn_verifying: "確認中",
            login_placeholder_user: "身分証明書番号", login_placeholder_pass: "パスワード",
            // Instagram Modal
            insta_title: "Instagram 問い合わせ",
            insta_sub: "ユーザーID(@xxx)を入力してください",
            insta_placeholder: "@ユーザー名",
            insta_btn: "認証する",
            insta_btn_verifying: "確認中",
            insta_success_btn: "Instagramを開く",
            insta_error_user: "ユーザーが見つかりません"
        },
        en: {
            card1_title: "Activation", card1_desc: "Enter code to<br>unlock content", card1_btn: "Use Code",
            card2_title: "News", card2_desc: "Updates about<br>this site.", card2_btn: "Check",
            card3_title: "Support", card3_desc: "Contact us if your code<br>is invalid or missing.", card3_btn: "Contact Us",
            modal_title: "Activation", modal_sub: "Please enter your code.",
            modal_placeholder: "Enter Code", modal_btn_auth: "CHECK",
            msg_verifying: "Checking",
            msg_invalid: "This code is invalid.", msg_used: "This code has already been used.", msg_error: "Connection error occurred.",
            success_badge: "The code has been activated.", success_main_title: "Activated content",
            success_label_name: "Content Name", btn_close: "Close", btn_download: "Download",
            news_title: "Latest News", news_label: "Changelog", 
            news_loading: "Checking for updates",
            support_modal_title: "What can I help you with?", btn_inquiry: "Stay tuned",
            footer_admin: "Enforcement Administrator",
            login_title: "Enforcement Administrator<br>LOGIN", login_desc: "Verifying access privileges.<br>Please enter ID Number and Password.",
            login_label_user: "ID Number", login_label_pass: "Password",
            login_btn: "Login", login_btn_verifying: "Verifying",
            login_placeholder_user: "ID Number", login_placeholder_pass: "Password",
            // Instagram Modal
            insta_title: "Instagram Inquiry",
            insta_sub: "Please enter your User ID (@xxx)",
            insta_placeholder: "@username",
            insta_btn: "Verify",
            insta_btn_verifying: "Checking...",
            insta_success_btn: "Open Instagram",
            insta_error_user: "User not found"
        },
        zh: {
            card1_title: "激活", card1_desc: "使用代码<br>以解锁内容", card1_btn: "使用代码",
            card2_title: "新闻", card2_desc: "本网站的<br>更新信息", card2_btn: "查看",
            card3_title: "支持", card3_desc: "如果代码无效<br>请联系我们", card3_btn: "联系我们",
            modal_title: "激活", modal_sub: "请输入您的激活码",
            modal_placeholder: "输入代码", modal_btn_auth: "检查",
            msg_verifying: "正在检查",
            msg_invalid: "该代码无效。", msg_used: "该代码已被使用。", msg_error: "发生通信错误",
            success_badge: "代码已激活。", success_main_title: "激活内容",
            success_label_name: "内容名称", btn_close: "关闭", btn_download: "下载",
            news_title: "最新消息", news_label: "更新日志", 
            news_loading: "正在检查更新",
            support_modal_title: "有什么可以帮到您的吗？", btn_inquiry: "敬请期待",
            footer_admin: "系统管理长",
            login_title: "系统管理员登录", login_desc: "正在检查访问权限。<br>请输入身份证号和密码。",
            login_label_user: "身份证号", login_label_pass: "密码",
            login_btn: "登录", login_btn_verifying: "验证中",
            login_placeholder_user: "身份证号", login_placeholder_pass: "密码",
            // Instagram Modal
            insta_title: "Instagram 咨询",
            insta_sub: "请输入您的用户ID（@xxx）",
            insta_placeholder: "@用户名",
            insta_btn: "验证",
            insta_btn_verifying: "正在验证",
            insta_success_btn: "打开 Instagram",
            insta_error_user: "未找到用户"
        },
        ko: {
            card1_title: "등록", card1_desc: "잠금해제 암호를<br>입력하십시오", card1_btn: "암호리용", 
            card2_title: "새 소식", card2_desc: "이 홈페지에 대한<br>최신 갱신자료", card2_btn: "열람", 
            card3_title: "기술협조", card3_desc: "암호가 맞지 않을 경우<br>여기로 련락하십시오", card3_btn: "질문", 
            modal_title: "리용등록", modal_sub: "보유하신 등록암호를 입력하십시오", 
            modal_placeholder: "암호입력", modal_btn_auth: "판정",
            msg_verifying: "검토중입니다", msg_invalid: "무효한 암호입니다.", msg_used: "이미 리용된 암호입니다.", msg_error: "망 련결오류가 발생하였습니다.", 
            success_badge: "암호가 등록되였습니다.", success_main_title: "등록된 자료", success_label_name: "자료명칭", btn_close: "닫기", btn_download: "적재", 
            news_title: "최신보도", news_label: "갱신리력", news_loading: "갱신자료 확인중입니다", 
            support_modal_title: "무엇을 도와드리면 되겠습니까?", btn_inquiry: "봉사대기", 
            footer_admin: "체계관리원", login_title: "체계관리원 접속", login_desc: "접근권한을 판정합니다。<br>신분번호와 통과암호를 입력하십시오。", 
            login_label_user: "공민등록번호", login_label_pass: "통과암호", login_btn: "접속", login_btn_verifying: "검토중", 
            login_placeholder_user: "공민등록번호", login_placeholder_pass: "통과암호",
            // Instagram Modal
            insta_title: "Instagram 문의",
            insta_sub: "사용자 ID(@xxx)를 입력하십시오",
            insta_placeholder: "@사용자명",
            insta_btn: "확인",
            insta_btn_verifying: "검토중",
            insta_success_btn: "인스타그램 열기",
            insta_error_user: "사용자를 찾을 수 없습니다"
        },
        ru: {
            card1_title: "Активация", card1_desc: "Введите код для разблокировки<br>контента", card1_btn: "Код использования",
            card2_title: "Новости", card2_desc: "Последние обновления<br>о проекте", card2_btn: "Проверить",
            card3_title: "Поддержка", card3_desc: "Свяжитесь с нами, если<br>код недействителен", card3_btn: "Связаться",
            modal_title: "Активация", modal_sub: "Пожалуйста, введите ваш код активации",
            modal_placeholder: "Введите код", modal_btn_auth: "Войти",
            msg_verifying: "Проверка",
            msg_invalid: "Неверный код.", msg_used: "Код уже использован.", msg_error: "Ошибка соединения",
            success_badge: "Код активирован.", success_main_title: "Активированный контент",
            success_label_name: "Название", btn_close: "Закрыть", btn_download: "Скачать",
            news_title: "Новости", news_label: "Список изменений", news_loading: "Проверка обновлений",
            support_modal_title: "Чем я могу вам помочь?", btn_inquiry: "Недоступно",
            footer_admin: "Администратор",
            login_title: "Администратор<br>Войти", login_desc: "Проверьте права доступа.<br>Введите свой идентификационный номер и пароль.",
            login_label_user: "Имя пользователя", login_label_pass: "Пароль",
            login_btn: "Войти", login_btn_verifying: "Проверка",
            login_placeholder_user: "Имя пользователя", login_placeholder_pass: "Пароль",
            // Instagram Modal
            insta_title: "Instagram Запрос",
            insta_sub: "Введите ваш User ID (@xxx)",
            insta_placeholder: "@username",
            insta_btn: "Проверить",
            insta_btn_verifying: "Проверка...",
            insta_success_btn: "Открыть Instagram",
            insta_error_user: "Пользователь не найден"
        }
    };

    // --- DOM要素 ---
    const langSelectionOverlay = document.getElementById('langSelectionOverlay');
    const adminLoginOverlay = document.getElementById('adminLoginOverlay');
    const mainContainer = document.getElementById('mainContainer');
    
    // Login elements
    const loginUser = document.getElementById('loginUser');
    const loginPass = document.getElementById('loginPass');
    const btnLoginAction = document.getElementById('btnLoginAction');
    const loginLangSwitcher = document.getElementById('loginLangSwitcher');

    // Main Site elements
    const authModal = document.getElementById('authModal');
    const modalContainer = document.getElementById('modalContainer');
    const openAuthBtn = document.getElementById('btnOpenModal');
    const closeAuthBtn = document.getElementById('modalCloseBtn');
    const closeSubBtn = document.getElementById('modalCloseSub');
    const inputPhase = document.getElementById('inputPhase');
    const successPhase = document.getElementById('successPhase');
    const codeInput = document.getElementById('activationCode');
    const confirmBtn = document.getElementById('btnConfirm');
    const statusContainer = document.getElementById('statusContainer');
    const successTitle = document.getElementById('successTitle');
    const successExtraInfo = document.getElementById('successExtraInfo');
    const successDownloadBtn = document.getElementById('successDownloadBtn');
    const successLeftCol = document.getElementById('successLeftCol');
    const successImage = document.getElementById('successImage');

    // News elements
    const newsList = document.getElementById('newsList');

    // --- 起動時のフロー制御 ---
    document.addEventListener('DOMContentLoaded', () => {
        const isLoggedIn = sessionStorage.getItem('is_admin_logged_in');
        const savedLang = localStorage.getItem('user_lang');
        const switcher = document.getElementById('languageSwitcher');

        if (savedLang) {
            updateLanguage(savedLang);
            switcher.value = savedLang;
            langSelectionOverlay.style.display = 'none';

            // ログイン済みかチェックし、未ログインならログイン画面へ
            if (isLoggedIn === 'true') {
                showMainContent();
            } else {
                showLoginScreen();
            }
        }
        
        fetchNews();
    });

    // 初回言語選択ボタン
    function setInitialLanguage(lang) {
        localStorage.setItem('user_lang', lang);
        updateLanguage(lang);
        document.getElementById('languageSwitcher').value = lang;
        
        langSelectionOverlay.style.opacity = '0';
        langSelectionOverlay.style.visibility = 'hidden';
        setTimeout(() => { 
            langSelectionOverlay.style.display = 'none'; 
            showLoginScreen();
        }, 500);
        
        fetchNews();
    }

    function showLoginScreen() {
        adminLoginOverlay.style.display = 'flex';
        if (loginLangSwitcher) loginLangSwitcher.value = CURRENT_LANG;
        requestAnimationFrame(() => { adminLoginOverlay.style.opacity = '1'; });
    }

    if (loginLangSwitcher) {
        loginLangSwitcher.addEventListener('change', (e) => {
            const lang = e.target.value;
            localStorage.setItem('user_lang', lang);
            updateLanguage(lang);
            document.getElementById('languageSwitcher').value = lang;
            fetchNews();
        });
    }

    btnLoginAction.addEventListener('click', async () => {
        const u = loginUser.value.trim();
        const p = loginPass.value.trim();
        const t = TRANSLATIONS[CURRENT_LANG];

        if (!u || !p) { shakeLoginCard(); return; }

        loginUser.disabled = true;
        loginPass.disabled = true;
        btnLoginAction.disabled = true;
        
        // ローディングアニメーション（...）
        btnLoginAction.innerHTML = `
            <span class="cyber-spinner" style="width:16px; height:16px; margin-right:5px;"></span>
            ${t.login_btn_verifying}<span class="loading-dots"></span>
        `;

        const requestUrl = `${GAS_API_URL}?type=login&user=${encodeURIComponent(u)}&pass=${encodeURIComponent(p)}`;

        try {
            const response = await fetch(requestUrl);
            const data = await response.json();

            if (data.success) {
                sessionStorage.setItem('is_admin_logged_in', 'true');
                adminLoginOverlay.style.opacity = '0';
                setTimeout(() => {
                    adminLoginOverlay.style.display = 'none';
                    showMainContent();
                }, 500);
            } else {
                throw new Error('Auth failed');
            }
        } catch (e) {
            console.error(e);
            loginUser.classList.add('error-border');
            loginPass.classList.add('error-border');
            shakeLoginCard();
            loginUser.disabled = false;
            loginPass.disabled = false;
            btnLoginAction.disabled = false;
            btnLoginAction.textContent = t.login_btn;
            setTimeout(() => {
                loginUser.classList.remove('error-border');
                loginPass.classList.remove('error-border');
            }, 2000);
        }
    });

    function shakeLoginCard() {
        const card = document.querySelector('.login-card');
        card.animate([ { transform: 'translateX(0)' }, { transform: 'translateX(-10px)' }, { transform: 'translateX(10px)' }, { transform: 'translateX(0)' } ], { duration: 300 });
    }

    function showMainContent() {
        mainContainer.classList.add('logged-in');
        lucide.createIcons();
    }

    document.getElementById('languageSwitcher').addEventListener('change', (e) => {
        const lang = e.target.value;
        localStorage.setItem('user_lang', lang);
        updateLanguage(lang);
        fetchNews(); 
    });

    function updateLanguage(lang) {
        CURRENT_LANG = lang;
        document.documentElement.lang = lang;
        const t = TRANSLATIONS[lang];
        if(!t) return;

        document.querySelectorAll('[data-translate]').forEach(el => {
            const key = el.getAttribute('data-translate');
            if(key !== 'news_content' && t[key]) el.innerHTML = t[key];
        });

        document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
            const key = el.getAttribute('data-translate-placeholder');
            if(t[key]) el.placeholder = t[key];
        });

        if(t.modal_placeholder) codeInput.placeholder = t.modal_placeholder;
        if(t.login_placeholder_user) loginUser.placeholder = t.login_placeholder_user;
        if(t.login_placeholder_pass) loginPass.placeholder = t.login_placeholder_pass;
        if (!btnLoginAction.disabled) btnLoginAction.textContent = t.login_btn;
        // Instagram Modal Input Placeholder
        if(t.insta_placeholder) instaInput.placeholder = t.insta_placeholder;
        if (!instaConfirm.disabled) instaConfirm.textContent = t.insta_btn;
    }

   // --- ★ニュース取得機能 (幅調整機能付き) ---
    async function fetchNews() {
        const newsList = document.getElementById('newsList');
        const newsHeader = document.getElementById('newsHeader'); 
        // ★モーダルのコンテナを取得
        const newsModalContainer = document.querySelector('#newsModal .modal-container');

        if (!newsList) return;
        
        const t = TRANSLATIONS[CURRENT_LANG];
        const loadingBase = t.news_loading || "Loading";

        // 1. 初期化：ヘッダー非表示 & 幅広モード解除（ローディング時は狭くする）
        if(newsHeader) newsHeader.style.display = 'none';
        if(newsModalContainer) newsModalContainer.classList.remove('news-wide-mode');

        // ローディング表示
        newsList.innerHTML = `
            <div style="text-align:center; color:#888; padding:20px;">
                ${loadingBase}<span class="loading-dots"></span>
            </div>`;
        
        try {
            const requestUrl = `${GAS_API_URL}?type=news&lang=${CURRENT_LANG}`;
            const response = await fetch(requestUrl);
            const data = await response.json();

            newsList.innerHTML = ''; // クリア

            if (data.success && data.news && data.news.length > 0) {
                // 2. 成功時：ヘッダー表示 & ★幅広モード適用（PCで1行表示にするため）
                if(newsHeader) newsHeader.style.display = 'flex';
                if(newsModalContainer) newsModalContainer.classList.add('news-wide-mode');

                data.news.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'news-item'; 
                    
                    li.innerHTML = `
                        <div class="news-date" lang="${CURRENT_LANG}">${item.date}</div>
                        <div class="news-content-text">${item.content}</div>
                    `;
                    newsList.appendChild(li);
                });
            } else {
                const noNewsMsg = (CURRENT_LANG === 'ja') ? 'お知らせはありません。' : 'No news available.';
                newsList.innerHTML = `<div style="text-align:center; color:#888; padding:20px;">${noNewsMsg}</div>`;
            }
        } catch (error) {
            console.error('News fetch error:', error);
            const errorMsg = (CURRENT_LANG === 'ja') ? '読み込みに失敗しました。' : 'Failed to load news.';
            newsList.innerHTML = `<div style="text-align:center; color:#ff6b6b; padding:20px;"><i data-lucide="alert-triangle" style="margin-bottom:5px;"></i><br>${errorMsg}</div>`;
            lucide.createIcons();
        }
    }

    // --- 認証モーダル操作 ---
    function openAuthModal() { authModal.classList.add('active'); resetAuthModal(); codeInput.focus(); }
    function closeAuthModal() { authModal.classList.remove('active'); }
    
    function resetAuthModal() {
        modalContainer.classList.remove('wide-mode');
        inputPhase.style.display = 'block';
        successPhase.style.display = 'none';
        codeInput.value = "";
        codeInput.disabled = false;
        confirmBtn.disabled = false;
        modalContainer.classList.remove('modal-error-border');
        codeInput.classList.remove('error-glow');
        confirmBtn.classList.remove('error-glow');
        const t = TRANSLATIONS[CURRENT_LANG];
        confirmBtn.textContent = t.modal_btn_auth;
        statusContainer.innerHTML = "";
        successImage.src = "";
        successLeftCol.style.display = 'none';
    }

    openAuthBtn.addEventListener('click', openAuthModal);
    closeAuthBtn.addEventListener('click', closeAuthModal);
    closeSubBtn.addEventListener('click', closeAuthModal);
    authModal.addEventListener('click', (e) => { if (e.target === authModal) closeAuthModal(); });

    // --- ニュースモーダル操作 ---
    const newsModal = document.getElementById('newsModal');
    const btnOpenNews = document.getElementById('btnOpenNews');
    const newsCloseX = document.getElementById('newsCloseX');
    // const newsCloseBtn = document.getElementById('newsCloseBtn'); // 削除したボタン

    function openNewsModal() {
        newsModal.classList.add('active');
        lucide.createIcons(); 
    }
    function closeNewsModal() {
        newsModal.classList.remove('active');
    }

    if(btnOpenNews) btnOpenNews.addEventListener('click', openNewsModal);
    if(newsCloseX) newsCloseX.addEventListener('click', closeNewsModal);
    // ボタン削除に伴いイベントリスナーも削除
    if(newsModal) newsModal.addEventListener('click', (e) => { if (e.target === newsModal) closeNewsModal(); });

    // --- サポートモーダル操作 ---
    const supportModal = document.getElementById('supportModal');
    const btnOpenSupport = document.getElementById('btnOpenSupport');
    const supportCloseX = document.getElementById('supportCloseX');
    
    function openSupportModal() { supportModal.classList.add('active'); lucide.createIcons(); }
    function closeSupportModal() { supportModal.classList.remove('active'); }

    if(btnOpenSupport) btnOpenSupport.addEventListener('click', openSupportModal);
    if(supportCloseX) supportCloseX.addEventListener('click', closeSupportModal);
    if(supportModal) supportModal.addEventListener('click', (e) => { if (e.target === supportModal) closeSupportModal(); });

    // --- Instagramモーダル操作 ---
    const btnOpenInstagram = document.getElementById('btnOpenInstagram');
    const instagramAuthModal = document.getElementById('instagramAuthModal');
    const instagramCloseBtn = document.getElementById('instagramCloseBtn');
    const instaInput = document.getElementById('instaInput');
    const instaConfirm = document.getElementById('instaConfirm');
    const instaStatusContainer = document.getElementById('instaStatusContainer');
    const instaInputPhase = document.getElementById('instaInputPhase');
    const instaSuccessPhase = document.getElementById('instaSuccessPhase');
    const instaSuccessMessage = document.getElementById('instaSuccessMessage');
    const instaSuccessButton = document.getElementById('instaSuccessButton');
    const instagramModalContainer = document.getElementById('instagramModalContainer');

    if(btnOpenInstagram) {
        btnOpenInstagram.addEventListener('click', () => {
            const t = TRANSLATIONS[CURRENT_LANG];
            // サポートモーダルを閉じる
            supportModal.classList.remove('active');
            // Instagramモーダルを開く
            instagramAuthModal.classList.add('active');
            // リセット
            instaInput.value = "";
            instaInput.disabled = false;
            instaConfirm.disabled = false;
            instaConfirm.innerHTML = t.insta_btn; // 翻訳テキスト適用
            instaStatusContainer.innerHTML = "";
            instaInputPhase.style.display = 'block';
            instaSuccessPhase.style.display = 'none';
            instagramModalContainer.classList.remove('modal-error-border');
            instaInput.classList.remove('error-glow');
            instaConfirm.classList.remove('error-glow');
            instaInput.focus();
        });
    }

    if(instagramCloseBtn) {
        instagramCloseBtn.addEventListener('click', () => {
            instagramAuthModal.classList.remove('active');
        });
    }

    if(instagramAuthModal) {
        instagramAuthModal.addEventListener('click', (e) => {
            if(e.target === instagramAuthModal) instagramAuthModal.classList.remove('active');
        });
    }

    // Instagram認証処理
    if(instaConfirm) {
        instaConfirm.addEventListener('click', async () => {
            const account = instaInput.value.trim();
            const t = TRANSLATIONS[CURRENT_LANG];
            
            if(!account) return;

            // ローディング (翻訳対応)
            instaInput.disabled = true;
            instaConfirm.disabled = true;
            instaConfirm.innerHTML = `<span class="cyber-spinner" style="width:16px; height:16px;"></span> ${t.insta_btn_verifying}`;
            instaStatusContainer.innerHTML = "";

            try {
                const requestUrl = `${GAS_API_URL}?type=instagram_auth&account=${encodeURIComponent(account)}&lang=${CURRENT_LANG}`;
                const response = await fetch(requestUrl);
                const data = await response.json();

                if(data.success) {
                    // 成功時
                    instaInputPhase.style.display = 'none';
                    instaSuccessPhase.style.display = 'block';
                    instaSuccessMessage.textContent = data.message;
                    instaSuccessButton.textContent = data.buttonLabel;
                    // アニメーション
                    instaSuccessPhase.animate([ { opacity: 0, transform: 'translateY(10px)' }, { opacity: 1, transform: 'translateY(0)' } ], { duration: 500 });
                } else {
                    // 失敗時
                    throw new Error(data.message || "Invalid account");
                }
            } catch (e) {
                console.error(e);
                instaInput.disabled = false;
                instaConfirm.disabled = false;
                instaConfirm.innerHTML = t.insta_btn; // 元に戻す
                // エラーメッセージ翻訳
                instaStatusContainer.innerHTML = `<span class="error-msg"><i data-lucide="alert-circle" size="14"></i> ${t.insta_error_user}</span>`;
                lucide.createIcons();
                
                // エラーアニメーション
                instagramModalContainer.animate([ { transform: 'translateX(0)' }, { transform: 'translateX(-10px)' }, { transform: 'translateX(10px)' }, { transform: 'translateX(0)' } ], { duration: 300 });
                instagramModalContainer.classList.add('modal-error-border');
                instaInput.classList.add('error-glow');
                instaConfirm.classList.add('error-glow');
                setTimeout(() => {
                    instagramModalContainer.classList.remove('modal-error-border');
                    instaInput.classList.remove('error-glow');
                    instaConfirm.classList.remove('error-glow');
                }, 1800);
            }
        });
    }


    // --- 入力フォーマット制御 ---
    codeInput.addEventListener('input', (e) => {
        let val = codeInput.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
        let chunkSize = (val.length >= 25) ? 5 : 4;
        let formatted = '';
        for(let i=0; i<val.length; i++){
            if(i>0 && i % chunkSize === 0) formatted += '-';
            formatted += val[i];
        }
        codeInput.value = formatted;
    });

    // ============================================
    // ★追加機能: 認証実行関数 (自動実行に対応)
    // ============================================
    // isSilent = true の場合、画面遷移アニメーションなどをスキップする
    async function performAuth(code, isSilent = false) {
        const t = TRANSLATIONS[CURRENT_LANG];
        
        // サイレントモードでなければローディング表示
        if (!isSilent) {
            codeInput.disabled = true;
            confirmBtn.disabled = true;
            confirmBtn.innerHTML = `<span class="cyber-spinner"></span> ${t.msg_verifying}<span class="loading-dots"></span>`;
            statusContainer.innerHTML = "";
            modalContainer.classList.remove('modal-error-border');
            codeInput.classList.remove('error-glow');
            confirmBtn.classList.remove('error-glow');
        }

        const requestUrl = `${GAS_API_URL}?key=${encodeURIComponent(code)}&lang=${CURRENT_LANG}`;

        try {
            const response = await fetch(requestUrl);
            const data = await response.json();
            
            // サイレントモードでなければボタン復帰
            if (!isSilent) {
                codeInput.disabled = false; 
                confirmBtn.disabled = false; 
                confirmBtn.textContent = t.modal_btn_auth; 
            }

            if (data.success) {
                // サイレントモードでない場合のみ画面遷移アニメーションを実行
                if (!isSilent) {
                    modalContainer.classList.add('wide-mode');
                    inputPhase.style.display = 'none';
                    successPhase.style.display = 'block';
                    successPhase.animate([ { opacity: 0, transform: 'translateY(10px)' }, { opacity: 1, transform: 'translateY(0)' } ], { duration: 500, easing: 'ease-out' });
                }

                // 以下の情報は常に最新に更新
                successTitle.textContent = data.message;
                successExtraInfo.textContent = data.extraInfo;
                successDownloadBtn.textContent = data.buttonLabel || t.btn_download;
                successDownloadBtn.href = data.actionUrl;

                // ★追加機能: 解禁日チェックと自動リロードタイマー
                if (data.isReleaseDateReached === false) {
                    // まだ解禁されていない場合
                    successDownloadBtn.style.pointerEvents = 'none'; // クリック不可
                    successDownloadBtn.style.opacity = '0.6';        // 半透明
                    successDownloadBtn.removeAttribute('href');      // リンク削除
                    // ボタンのテキストを解禁日表示に変更 (例: "🔒 2026/05/20 12:00")
                    successDownloadBtn.innerHTML = `<i data-lucide="lock" size="16" style="margin-right:5px;"></i> ${data.releaseDateStr}`;

                    // ==========================================
                    // ★自動リロードタイマーのセット (スマホ対応強化版)
                    // ==========================================
                    // GASから送られてくる ISO形式(releaseDateIso) を優先して使う
                    const dateSource = data.releaseDateIso || data.releaseDateStr;

                    if (dateSource) {
                          let parseableDate = dateSource;
                          // ISO形式がない場合（古いキャッシュなど）の予備処理: ドットやハイフンをスラッシュに統一
                          if (!data.releaseDateIso && typeof dateSource === 'string') {
                            parseableDate = dateSource.replace(/\./g, '/').replace(/-/g, '/');
                          }
                          
                          const targetDate = new Date(parseableDate); 
                          const now = new Date();
                          
                          // ターゲットまでのミリ秒数計算
                          let diff = targetDate.getTime() - now.getTime();
                          
                          // ログで確認（PCのF12ツール用）
                          console.log("Timer Target:", targetDate, "Diff:", diff);

                          // 24時間以内の未来ならタイマーセット
                          if (diff > 0 && diff < 86400000) { 
                              // バッファとして3秒(3000ms)追加して再実行
                              setTimeout(() => {
                                  console.log("Auto-reloading...");
                                  performAuth(code, true); 
                              }, diff + 3000);
                          }
                    }

                } else {
                    // 解禁済み（通常通り）
                    successDownloadBtn.style.pointerEvents = 'auto';
                    successDownloadBtn.style.opacity = '1';
                    // もし以前ロック表示だった場合、ここで通常のボタン表示に戻る
                    // （data.buttonLabel で上書き済み）
                }

                if (data.imageUrl && data.imageUrl.startsWith("http")) {
                    successImage.src = data.imageUrl;
                    successLeftCol.style.display = 'block';
                } else {
                    successLeftCol.style.display = 'none';
                }
                lucide.createIcons();
            } else {
                // 失敗時はサイレントモード関係なくエラー表示（通常ありえないが）
                let errorMsg = t.msg_invalid;
                if (data.message === "This code has already been used.") errorMsg = t.msg_used;
                statusContainer.innerHTML = `<span class="error-msg"><i data-lucide="alert-circle" size="14"></i> ${errorMsg}</span>`;
                lucide.createIcons();
                
                if (!isSilent) {
                    shakeModal();
                    modalContainer.classList.add('modal-error-border');
                    codeInput.classList.add('error-glow');
                    confirmBtn.classList.add('error-glow');
                    setTimeout(() => {
                        modalContainer.classList.remove('modal-error-border');
                        codeInput.classList.remove('error-glow');
                        confirmBtn.classList.remove('error-glow');
                    }, 1800);
                }
            }
        } catch (error) {
            console.error(error);
            if (!isSilent) {
                codeInput.disabled = false; confirmBtn.disabled = false; confirmBtn.textContent = t.modal_btn_auth;
                statusContainer.innerHTML = `<span class="error-msg">${t.msg_error}</span>`;
                modalContainer.classList.add('modal-error-border');
                codeInput.classList.add('error-glow');
                confirmBtn.classList.add('error-glow');
                setTimeout(() => {
                    modalContainer.classList.remove('modal-error-border');
                    codeInput.classList.remove('error-glow');
                    confirmBtn.classList.remove('error-glow');
                }, 3000);
            }
        }
    }

    // --- ボタンクリックイベント ---
    confirmBtn.addEventListener('click', () => {
        const code = codeInput.value.trim();
        if(!code) return;
        // 手動クリックなので isSilent = false (デフォルト)
        performAuth(code); 
    });

    function shakeModal() {
        modalContainer.animate([ { transform: 'translateX(0)' }, { transform: 'translateX(-10px)' }, { transform: 'translateX(10px)' }, { transform: 'translateX(0)' } ], { duration: 300 });
    }

    successDownloadBtn.addEventListener('mouseenter', () => { modalContainer.classList.add('sync-blue-mode'); });
    successDownloadBtn.addEventListener('mouseleave', () => { modalContainer.classList.remove('sync-blue-mode'); });

</script>
</body>
</html>
