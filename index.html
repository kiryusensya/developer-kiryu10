<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>_.k__yu.10 | Portal</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Outfit:wght@400;700&display=swap" rel="stylesheet">

    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* --- ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š --- */
        :root {
            --primary-color: #3b82f6;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-main: #ffffff;
            --text-muted: rgba(255, 255, 255, 0.7);
            --neon-cyan: #00f7ff;
            --neon-green: #00ff9d;
        }

        body {
            font-family: "HarmonyOS Sans", "Outfit", "Noto Sans JP", "Microsoft YaHei", "Malgun Gothic", sans-serif;
            margin: 0; padding: 0; min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            color: var(--text-main);
            background-image: url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072&auto=format&fit=crop');
            background-size: cover; background-position: center; background-attachment: fixed;
            overflow-x: hidden; /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ */
        }

        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5); z-index: -1;
        }

        /* --- å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ --- */
        .glass-panel {
            background: var(--glass-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* --- ãƒ˜ãƒƒãƒ€ãƒ¼ --- */
        header {
            width: 100%; max-width: 1200px; padding: 20px; box-sizing: border-box;
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px;
        }
        .logo { font-size: 24px; font-weight: 700; letter-spacing: 1px; display: flex; align-items: center; gap: 10px; }
        .header-right { display: flex; align-items: center; gap: 20px; }
        .lang-select {
            background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); color: white;
            padding: 5px 10px; border-radius: 20px; outline: none; cursor: pointer;
            font-family: inherit;
        }
        .lang-select option { background-color: #333; color: white; }

        .profile-img {
            width: 45px; height: 45px; border-radius: 50%;
            background-image: url('https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?auto=format&fit=crop&w=100&h=100');
            background-size: cover; border: 2px solid rgba(255,255,255,0.5);
        }

        /* --- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ --- */
        .container {
            width: 100%; max-width: 1000px; padding: 0 20px; box-sizing: border-box;
            flex: 1; display: flex; flex-direction: column; justify-content: center;
        }
        .grid-menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; margin-bottom: 50px; }
        .menu-card {
            border-radius: 24px; padding: 40px 30px; text-align: center;
            transition: transform 0.3s ease, background 0.3s ease; cursor: default;
            display: flex; flex-direction: column; align-items: center;
        }
        .menu-card:hover { transform: translateY(-10px); background: rgba(255, 255, 255, 0.15); }
        .card-icon-box {
            width: 80px; height: 80px; background: rgba(255,255,255,0.1); border-radius: 50%;
            display: flex; justify-content: center; align-items: center; margin-bottom: 20px; color: #60a5fa;
        }
        .card-title { font-size: 22px; font-weight: bold; margin: 0 0 10px 0; }
        .card-desc { font-size: 14px; color: var(--text-muted); margin: 0 0 25px 0; line-height: 1.6; }
        
        .btn-action {
            display: inline-flex; align-items: center; gap: 8px; padding: 12px 30px; border-radius: 50px;
            background: var(--primary-color); color: white; text-decoration: none; font-weight: bold; font-size: 15px;
            border: none; cursor: pointer; transition: background 0.2s, transform 0.2s;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
            font-family: inherit; justify-content: center;
        }
        .btn-action:hover { background: #2563eb; transform: scale(1.05); }

        footer { padding: 20px; font-size: 13px; color: var(--text-muted); text-align: center; width: 100%; }
        .footer-link { color: white; text-decoration: none; border-bottom: 1px dotted white; }

        /* --- â˜…è¨€èªé¸æŠã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ (æ–°è¦è¿½åŠ )â˜… --- */
        #langSelectionOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(15px);
            z-index: 9999; /* æœ€å‰é¢ */
            display: flex; justify-content: center; align-items: center;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        .lang-modal {
            width: 90%; max-width: 500px; padding: 40px; text-align: center; border-radius: 24px;
        }
        .lang-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 30px;
        }
        /* ãƒ­ã‚·ã‚¢èªãªã©ãƒœã‚¿ãƒ³ãŒ5ã¤ã®å ´åˆã®èª¿æ•´ */
        .lang-grid button:last-child:nth-child(odd) {
            grid-column: span 2; /* æœ€å¾Œã®1å€‹ã¯ä¸­å¤®å¯„ã› */
        }

        /* --- ãƒ¢ãƒ¼ãƒ€ãƒ«åŸºæœ¬è¨­å®š --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px);
            display: flex; justify-content: center; align-items: center; z-index: 2000;
            opacity: 0; visibility: hidden; transition: opacity 0.4s ease, visibility 0.4s ease;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }

        .modal-container {
            width: 90%; max-width: 480px; border-radius: 24px; padding: 40px; text-align: center;
            position: relative; transform: scale(0.9); transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            max-height: 90vh; overflow-y: auto;
        }
        .modal-overlay.active .modal-container { transform: scale(1); }
        .modal-container.wide-mode { max-width: 900px; padding: 0; display: flex; overflow: hidden; }

        .modal-close {
            position: absolute; top: 20px; right: 20px; cursor: pointer; color: rgba(255,255,255,0.6); transition: color 0.2s; z-index: 100;
        }
        .modal-close:hover { color: white; }

        #inputPhase { width: 100%; }
        .modal-title { font-size: 26px; margin-bottom: 10px; font-weight: bold; }
        .modal-sub { font-size: 14px; color: var(--text-muted); margin-bottom: 30px; }
        .input-wrapper { margin-bottom: 25px; }
        .code-input {
            width: 100%; box-sizing: border-box; background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border); border-radius: 12px; padding: 16px;
            color: white; font-size: 18px; text-align: center; letter-spacing: 3px;
            font-family: monospace; outline: none; transition: border-color 0.3s, box-shadow 0.3s;
            text-transform: uppercase;
        }
        .code-input:focus { border-color: var(--primary-color); box-shadow: 0 0 15px rgba(59, 130, 246, 0.3); }
        
        .btn-confirm {
            width: 100%; padding: 16px; border-radius: 12px; background: var(--primary-color);
            color: white; border: none; font-size: 16px; font-weight: bold; cursor: pointer;
            transition: all 0.2s; display: flex; justify-content: center; align-items: center;
            min-height: 56px; box-sizing: border-box; font-family: inherit;
        }
        .btn-confirm:hover { background: #2563eb; transform: translateY(-2px); }
        .btn-confirm:disabled { background: #2563eb; opacity: 0.8; cursor: wait; transform: none; }
        
        #successPhase { display: none; width: 100%; height: 100%; }
        .success-layout { display: flex; width: 100%; min-height: 500px; }
        .success-left { flex: 1; background-color: rgba(0,0,0,0.3); position: relative; display: none; }
        .success-left img { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; }
        .success-right { flex: 1.2; padding: 40px; display: flex; flex-direction: column; justify-content: center; align-items: flex-start; text-align: left; }

        .success-tag {
            background: rgba(0, 255, 157, 0.1); border: 1px solid var(--neon-green); color: var(--neon-green);
            padding: 8px 16px; border-radius: 30px; font-size: 14px; font-weight: bold; margin-bottom: 20px; 
            display: inline-flex; align-items: center; gap: 8px;
            box-shadow: 0 0 15px rgba(0, 255, 157, 0.4), inset 0 0 10px rgba(0, 255, 157, 0.1);
            text-shadow: 0 0 8px rgba(0, 255, 157, 0.6); font-family: inherit;
        }
        .success-tag svg { filter: drop-shadow(0 0 5px rgba(0, 255, 157, 0.8)); }
        .success-title-main { font-size: 28px; font-weight: bold; margin-bottom: 20px; line-height: 1.3; }
        .success-info-box { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; width: 100%; box-sizing: border-box; margin-bottom: 25px; }
        .success-label { font-size: 12px; color: var(--text-muted); }
        .success-content { font-size: 18px; font-weight: bold; margin-top: 5px; color: #60a5fa; }
        .success-extra { font-size: 14px; margin-top: 10px; color: #ddd; white-space: pre-wrap; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px;}

        .btn-group { display: flex; gap: 15px; width: 100%; }
        #successDownloadBtn { flex: 2; text-decoration: none; text-align: center; }
        #modalCloseSub {
            flex: 1; background: transparent; border: 2px solid rgba(255,255,255,0.3); color: white;
            padding: 16px; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer;
            transition: all 0.2s; display: flex; justify-content: center; align-items: center;
            min-height: 56px; box-sizing: border-box; font-family: inherit;
        }
        #modalCloseSub:hover { background: rgba(255,255,255,0.1); border-color: #fff; }

        @media (max-width: 768px) {
            .modal-container.wide-mode { flex-direction: column; max-width: 90%; overflow-y: scroll; }
            .success-layout { flex-direction: column; }
            .success-left { width: 100%; min-height: 200px; display: block; position: relative; }
            .success-left img { position: relative; height: 200px; }
            .success-right { padding: 30px 20px; align-items: center; text-align: center; }
            .success-info-box { text-align: left; }
            .success-right { align-items: stretch; }
            .lang-grid { grid-template-columns: 1fr; } /* ã‚¹ãƒãƒ›ã¯1åˆ— */
            .lang-grid button:last-child:nth-child(odd) { grid-column: span 1; }
        }

        #statusContainer { margin-top: 15px; font-size: 14px; }
        .error-msg { color: #ff6b6b; display: flex; align-items: center; justify-content: center; gap: 5px; }

        .cyber-spinner { position: relative; width: 24px; height: 24px; display: inline-block; margin-right: 12px; }
        .cyber-spinner::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 2px solid transparent;
            border-top-color: var(--neon-cyan); border-right-color: var(--neon-cyan); border-radius: 50%;
            animation: spin-cyber 1.2s linear infinite; box-shadow: 0 0 8px rgba(0, 247, 255, 0.6);
        }
        .cyber-spinner::after {
            content: ''; position: absolute; top: 4px; left: 4px; width: calc(100% - 8px); height: calc(100% - 8px);
            border: 2px solid transparent; border-bottom-color: #ffffff; border-left-color: #ffffff;
            border-radius: 50%; animation: spin-cyber-reverse 0.8s linear infinite;
        }
        @keyframes spin-cyber { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes spin-cyber-reverse { 0% { transform: rotate(0deg); } 100% { transform: rotate(-360deg); } }

        .loading-dots::after {
            display: inline-block; animation: dot-steps 1.5s infinite steps(1);
            content: '.'; width: 1.2em; text-align: left;
        }
        @keyframes dot-steps { 0% { content: '.'; } 33% { content: '..'; } 67% { content: '...'; } }

    </style>
</head>
<body>

    <div id="langSelectionOverlay">
        <div class="glass-panel lang-modal">
            <div class="logo" style="justify-content:center; margin-bottom:20px;">
                <i data-lucide="globe" size="32" style="color: #60a5fa;"></i>
            </div>
            <h2 style="font-size: 24px; margin-bottom: 10px;">Select Language</h2>
            <p style="color:rgba(255,255,255,0.7); font-size:14px;">è¨€èªã‚’é¸æŠã—ã¦ãã ã•ã„</p>
            
            <div class="lang-grid">
                <button class="btn-action" onclick="setInitialLanguage('ja')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
                <button class="btn-action" onclick="setInitialLanguage('en')">ğŸ‡ºğŸ‡¸ English</button>
                <button class="btn-action" onclick="setInitialLanguage('zh')">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</button>
                <button class="btn-action" onclick="setInitialLanguage('ko')">ğŸ‡°ğŸ‡· í•œêµ­ì–´</button>
                <button class="btn-action" onclick="setInitialLanguage('ru')">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>
            </div>
        </div>
    </div>

    <header>
        <div class="logo"><i data-lucide="box" style="color: #60a5fa;"></i>_.k__yu.10</div>
        <div class="header-right">
            <select id="languageSwitcher" class="lang-select glass-panel">
                <option value="ja" selected>JP (æ—¥æœ¬èª)</option>
                <option value="en">EN (English)</option>
                <option value="zh">ZH (ä¸­æ–‡)</option>
                <option value="ko">KO (í•œêµ­ì–´)</option>
                <option value="ru">RU (Ğ ÑƒÑÑĞºĞ¸Ğ¹)</option>
            </select>
            <div class="profile-img"></div>
        </div>
    </header>

    <div class="container">
        <div class="grid-menu">
            <div class="menu-card glass-panel">
                <div class="card-icon-box"><i data-lucide="key" size="40"></i></div>
                <h3 class="card-title" data-translate="card1_title">ã‚¢ã‚¯ã‚»ã‚¹è§£æ”¾</h3>
                <p class="card-desc" data-translate="card1_desc">ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦<br>é™å®šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¢ãƒ³ãƒ­ãƒƒã‚¯</p>
                <button id="btnOpenModal" class="btn-action">
                    <span data-translate="card1_btn">ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›</span><i data-lucide="arrow-right" size="16"></i>
                </button>
            </div>

            <div class="menu-card glass-panel">
                <div class="card-icon-box" style="color: #f472b6;"><i data-lucide="newspaper" size="40"></i></div>
                <h3 class="card-title" data-translate="card2_title">ãƒ‹ãƒ¥ãƒ¼ã‚¹</h3>
                <p class="card-desc" data-translate="card2_desc">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é–¢ã™ã‚‹<br>æœ€æ–°ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæƒ…å ±</p>
                <a href="#" class="btn-action" style="background: rgba(255,255,255,0.1);">
                    <span data-translate="card2_btn">ç¢ºèªã™ã‚‹</span>
                </a>
            </div>

            <div class="menu-card glass-panel">
                <div class="card-icon-box" style="color: #34d399;"><i data-lucide="message-circle" size="40"></i></div>
                <h3 class="card-title" data-translate="card3_title">ã‚µãƒãƒ¼ãƒˆ</h3>
                <p class="card-desc" data-translate="card3_desc">ã‚³ãƒ¼ãƒ‰ãŒç„¡åŠ¹ãªå ´åˆãªã©ã¯<br>ã“ã¡ã‚‰ã‹ã‚‰ã”é€£çµ¡ãã ã•ã„</p>
                <a href="https://lit.link/kiryusensya" class="btn-action" style="background: rgba(255,255,255,0.1);">
                    <span data-translate="card3_btn">å•ã„åˆã‚ã›</span>
                </a>
            </div>
        </div>
    </div>

    <footer>
        System Admin: <a href="https://lit.link/kiryusensya" target="_blank" class="footer-link">kiryu-sensya</a>
        <br><span style="opacity: 0.5; font-size: 11px;">Â© 2026 kiryu-sensya. All rights reserved.</span>
    </footer>

    <div id="authModal" class="modal-overlay">
        <div class="modal-container glass-panel" id="modalContainer">
            <div class="modal-close" id="modalCloseBtn"><i data-lucide="x"></i></div>

            <div id="inputPhase">
                <h2 class="modal-title" data-translate="modal_title">ã‚¢ã‚¯ã‚»ã‚¹è§£æ”¾</h2>
                <p class="modal-sub" data-translate="modal_sub">ãŠæ‰‹æŒã¡ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
                <div class="input-wrapper">
                    <input type="text" id="activationCode" class="code-input" placeholder="ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›" autocomplete="off">
                </div>
                <button id="btnConfirm" class="btn-confirm" data-translate="modal_btn_auth">èªè¨¼ã™ã‚‹</button>
                <div id="statusContainer"></div>
            </div>

            <div id="successPhase">
                <div class="success-layout">
                    <div class="success-left" id="successLeftCol">
                        <img id="successImage" src="" alt="Result Image">
                    </div>
                    
                    <div class="success-right">
                        
                        <div class="success-tag">
                            <i data-lucide="check-circle" size="18"></i>
                            <span data-translate="success_badge">ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‰¿èªã•ã‚Œã¾ã—ãŸ</span>
                        </div>
                        
                        <h2 class="success-title-main" data-translate="success_main_title">åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä¸€è¦§</h2>
                        
                        <div class="success-info-box">
                            <div class="success-label" data-translate="success_label_name">ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åç§°</div>
                            <div class="success-content" id="successTitle">Loading...</div>
                            <div class="success-extra" id="successExtraInfo"></div>
                        </div>

                        <div class="btn-group">
                            <button id="modalCloseSub" data-translate="btn_close">
                                é–‰ã˜ã‚‹
                            </button>
                            <a href="#" id="successDownloadBtn" class="btn-confirm" data-translate="btn_download">
                                ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                            </a>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>

<script>
    lucide.createIcons();
    const GAS_API_URL = "https://script.google.com/macros/s/AKfycbwFVUjphTbnkGeGdMrAP3U8uN5kJSsYUjVS4yJhtlL41pRwW15paLkBMLWA7y4i2boNEQ/exec"; 
    let CURRENT_LANG = "ja"; 

    // --- ç¿»è¨³ãƒ‡ãƒ¼ã‚¿ (5è¨€èª) ---
    const TRANSLATIONS = {
        ja: {
            card1_title: "ã‚¢ã‚¯ã‚»ã‚¹è§£æ”¾", card1_desc: "ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦<br>é™å®šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¢ãƒ³ãƒ­ãƒƒã‚¯", card1_btn: "ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›",
            card2_title: "ãƒ‹ãƒ¥ãƒ¼ã‚¹", card2_desc: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é–¢ã™ã‚‹<br>æœ€æ–°ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæƒ…å ±", card2_btn: "ç¢ºèªã™ã‚‹",
            card3_title: "ã‚µãƒãƒ¼ãƒˆ", card3_desc: "ã‚³ãƒ¼ãƒ‰ãŒç„¡åŠ¹ãªå ´åˆãªã©ã¯<br>ã“ã¡ã‚‰ã‹ã‚‰ã”é€£çµ¡ãã ã•ã„", card3_btn: "å•ã„åˆã‚ã›",
            modal_title: "ã‚¢ã‚¯ã‚»ã‚¹è§£æ”¾", modal_sub: "ãŠæ‰‹æŒã¡ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
            modal_placeholder: "ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›", modal_btn_auth: "èªè¨¼ã™ã‚‹",
            msg_verifying: "ç¢ºèªä¸­",
            msg_invalid: "ç„¡åŠ¹ã¾ãŸã¯ä½¿ç”¨æ¸ˆã¿ã‚³ãƒ¼ãƒ‰ã§ã™", msg_error: "é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ",
            success_badge: "ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‰¿èªã•ã‚Œã¾ã—ãŸ", success_main_title: "åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä¸€è¦§",
            success_label_name: "ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åç§°", btn_close: "é–‰ã˜ã‚‹", btn_download: "ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"
        },
        en: {
            card1_title: "Activation", card1_desc: "Enter code to unlock<br>exclusive content", card1_btn: "Enter Code",
            card2_title: "News", card2_desc: "Latest updates regarding<br>the project", card2_btn: "Check Now",
            card3_title: "Support", card3_desc: "Contact us if your code<br>is invalid or missing", card3_btn: "Contact Us",
            modal_title: "Activation", modal_sub: "Please enter your activation code below",
            modal_placeholder: "Enter Code", modal_btn_auth: "Authenticate",
            msg_verifying: "Verifying",
            msg_invalid: "Invalid or used code", msg_error: "Connection error occurred",
            success_badge: "Access Granted", success_main_title: "Available Content",
            success_label_name: "Content Name", btn_close: "Close", btn_download: "Download"
        },
        zh: {
            card1_title: "è®¿é—®è§£é”", card1_desc: "è¾“å…¥ä»£ç ä»¥è§£é”<br>ç‹¬å®¶å†…å®¹", card1_btn: "è¾“å…¥ä»£ç ",
            card2_title: "æ–°é—»", card2_desc: "å…³äºé¡¹ç›®çš„<br>æœ€æ–°æ›´æ–°ä¿¡æ¯", card2_btn: "æŸ¥çœ‹",
            card3_title: "æ”¯æŒ", card3_desc: "å¦‚æœä»£ç æ— æ•ˆ<br>è¯·è”ç³»æˆ‘ä»¬", card3_btn: "è”ç³»æˆ‘ä»¬",
            modal_title: "è®¿é—®è§£é”", modal_sub: "è¯·è¾“å…¥æ‚¨çš„æ¿€æ´»ç ",
            modal_placeholder: "è¾“å…¥ä»£ç ", modal_btn_auth: "è®¤è¯",
            msg_verifying: "ç¡®è®¤ä¸­",
            msg_invalid: "ä»£ç æ— æ•ˆæˆ–å·²ä½¿ç”¨", msg_error: "å‘ç”Ÿé€šä¿¡é”™è¯¯",
            success_badge: "è®¿é—®å·²æ‰¹å‡†", success_main_title: "å¯ç”¨å†…å®¹åˆ—è¡¨",
            success_label_name: "å†…å®¹åç§°", btn_close: "å…³é—­", btn_download: "ä¸‹è½½"
        },
        ko: {
            card1_title: "ì•¡ì„¸ìŠ¤ í•´ì œ", card1_desc: "ì½”ë“œë¥¼ ì…ë ¥í•˜ì—¬<br>í•œì • ì½˜í…ì¸  ì ê¸ˆ í•´ì œ", card1_btn: "ì½”ë“œ ì…ë ¥",
            card2_title: "ë‰´ìŠ¤", card2_desc: "í”„ë¡œì íŠ¸ì— ê´€í•œ<br>ìµœì‹  ì—…ë°ì´íŠ¸ ì •ë³´", card2_btn: "í™•ì¸í•˜ê¸°",
            card3_title: "ì§€ì›", card3_desc: "ì½”ë“œê°€ ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš°<br>ì—¬ê¸°ë¡œ ì—°ë½ì£¼ì‹­ì‹œì˜¤", card3_btn: "ë¬¸ì˜í•˜ê¸°",
            modal_title: "ì•¡ì„¸ìŠ¤ í•´ì œ", modal_sub: "ë³´ìœ í•˜ì‹  í™œì„±í™” ì½”ë“œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”",
            modal_placeholder: "ì½”ë“œ ì…ë ¥", modal_btn_auth: "ì¸ì¦í•˜ê¸°",
            msg_verifying: "í™•ì¸ ì¤‘",
            msg_invalid: "ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ì‚¬ìš©ëœ ì½”ë“œì…ë‹ˆë‹¤", msg_error: "í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",
            success_badge: "ì•¡ì„¸ìŠ¤ ìŠ¹ì¸ë¨", success_main_title: "ì´ìš© ê°€ëŠ¥í•œ ì½˜í…ì¸  ëª©ë¡",
            success_label_name: "ì½˜í…ì¸  ëª…ì¹­", btn_close: "ë‹«ê¸°", btn_download: "ë‹¤ìš´ë¡œë“œ"
        },
        ru: {
            card1_title: "Ğ”Ğ¾ÑÑ‚ÑƒĞ¿", card1_desc: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ´ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸<br>ÑĞºÑĞºĞ»ÑĞ·Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ°", card1_btn: "Ğ’Ğ²Ğ¾Ğ´ ĞºĞ¾Ğ´Ğ°",
            card2_title: "ĞĞ¾Ğ²Ğ¾ÑÑ‚Ğ¸", card2_desc: "ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ<br>Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ", card2_btn: "ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ",
            card3_title: "ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°", card3_desc: "Ğ¡Ğ²ÑĞ¶Ğ¸Ñ‚ĞµÑÑŒ Ñ Ğ½Ğ°Ğ¼Ğ¸, ĞµÑĞ»Ğ¸<br>ĞºĞ¾Ğ´ Ğ½ĞµĞ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ĞµĞ½", card3_btn: "Ğ¡Ğ²ÑĞ·Ğ°Ñ‚ÑŒÑÑ",
            modal_title: "ĞĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ", modal_sub: "ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ²Ğ°Ñˆ ĞºĞ¾Ğ´ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¸",
            modal_placeholder: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ´", modal_btn_auth: "Ğ’Ğ¾Ğ¹Ñ‚Ğ¸",
            msg_verifying: "ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°",
            msg_invalid: "ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ¸Ğ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´", msg_error: "ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ",
            success_badge: "Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½", success_main_title: "Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚",
            success_label_name: "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ", btn_close: "Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ", btn_download: "Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ"
        }
    };

    // --- åˆæœŸè¨€èªè¨­å®š ---
    function setInitialLanguage(lang) {
        updateLanguage(lang);
        // ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚‚åŒæœŸã•ã›ã‚‹
        document.getElementById('languageSwitcher').value = lang;
        
        // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’éè¡¨ç¤ºã«ã™ã‚‹
        const overlay = document.getElementById('langSelectionOverlay');
        overlay.style.opacity = '0';
        overlay.style.visibility = 'hidden';
    }

    // --- è¨€èªåˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯ ---
    function updateLanguage(lang) {
        CURRENT_LANG = lang;
        const t = TRANSLATIONS[lang];
        if(!t) return;

        // data-translateå±æ€§ã‚’æŒã¤å…¨è¦ç´ ã‚’æ›¸ãæ›ãˆ
        document.querySelectorAll('[data-translate]').forEach(el => {
            const key = el.getAttribute('data-translate');
            if(t[key]) el.innerHTML = t[key];
        });

        // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®æ›¸ãæ›ãˆ
        if(t.modal_placeholder) {
            codeInput.placeholder = t.modal_placeholder;
        }
    }

    document.getElementById('languageSwitcher').addEventListener('change', (e) => {
        updateLanguage(e.target.value);
    });

    // DOMè¦ç´ 
    const modal = document.getElementById('authModal');
    const modalContainer = document.getElementById('modalContainer');
    const openBtn = document.getElementById('btnOpenModal');
    const closeBtn = document.getElementById('modalCloseBtn');
    const closeSubBtn = document.getElementById('modalCloseSub');
    
    const inputPhase = document.getElementById('inputPhase');
    const successPhase = document.getElementById('successPhase');
    
    const codeInput = document.getElementById('activationCode');
    const confirmBtn = document.getElementById('btnConfirm');
    const statusContainer = document.getElementById('statusContainer');
    
    const successTitle = document.getElementById('successTitle');
    const successExtraInfo = document.getElementById('successExtraInfo');
    const successDownloadBtn = document.getElementById('successDownloadBtn');
    const successLeftCol = document.getElementById('successLeftCol');
    const successImage = document.getElementById('successImage');

    // ãƒ¢ãƒ¼ãƒ€ãƒ«æ“ä½œ
    function openModal() { modal.classList.add('active'); resetModal(); codeInput.focus(); }
    function closeModal() { modal.classList.remove('active'); }
    
    function resetModal() {
        modalContainer.classList.remove('wide-mode');
        inputPhase.style.display = 'block';
        successPhase.style.display = 'none';
        codeInput.value = "";
        codeInput.disabled = false;
        confirmBtn.disabled = false;
        
        // è¨€èªã«åˆã‚ã›ã¦ãƒœã‚¿ãƒ³ã®æ–‡å­—ã‚’ãƒªã‚»ãƒƒãƒˆ
        const t = TRANSLATIONS[CURRENT_LANG];
        confirmBtn.textContent = t.modal_btn_auth;
        
        statusContainer.innerHTML = "";
        successImage.src = "";
        successLeftCol.style.display = 'none';
    }

    openBtn.addEventListener('click', openModal);
    closeBtn.addEventListener('click', closeModal);
    closeSubBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

    // å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆåˆ¶å¾¡ (25æ–‡å­—ä»¥ä¸Šã§5æ–‡å­—åŒºåˆ‡ã‚Š)
    codeInput.addEventListener('input', (e) => {
        let val = codeInput.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
        let chunkSize = (val.length >= 25) ? 5 : 4;
        let formatted = '';
        for(let i=0; i<val.length; i++){
            if(i>0 && i % chunkSize === 0) formatted += '-';
            formatted += val[i];
        }
        codeInput.value = formatted;
    });

    // èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯
    confirmBtn.addEventListener('click', async () => {
        const code = codeInput.value.trim();
        if(!code) return;
        
        const t = TRANSLATIONS[CURRENT_LANG];

        codeInput.disabled = true;
        confirmBtn.disabled = true;
        // ç¿»è¨³ã•ã‚ŒãŸã€Œç¢ºèªä¸­ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½¿ç”¨
        confirmBtn.innerHTML = `<span class="cyber-spinner"></span> ${t.msg_verifying}<span class="loading-dots"></span>`;
        statusContainer.innerHTML = "";

        // GASã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«ç¾åœ¨ã®è¨€èªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä»˜ä¸
        const requestUrl = `${GAS_API_URL}?key=${encodeURIComponent(code)}&lang=${CURRENT_LANG}`;
        try {
            const response = await fetch(requestUrl);
            const data = await response.json();
            
            codeInput.disabled = false; 
            confirmBtn.disabled = false; 
            confirmBtn.textContent = t.modal_btn_auth; 

            if (data.success) {
                modalContainer.classList.add('wide-mode');
                inputPhase.style.display = 'none';
                
                successPhase.style.display = 'block';
                successPhase.animate([
                    { opacity: 0, transform: 'translateY(10px)' },
                    { opacity: 1, transform: 'translateY(0)' }
                ], { duration: 500, easing: 'ease-out' });

                successTitle.textContent = data.message;
                successExtraInfo.textContent = data.extraInfo;
                successDownloadBtn.textContent = data.buttonLabel || t.btn_download;
                successDownloadBtn.href = data.actionUrl;

                if (data.imageUrl && data.imageUrl.startsWith("http")) {
                    successImage.src = data.imageUrl;
                    successLeftCol.style.display = 'block';
                } else {
                    successLeftCol.style.display = 'none';
                }
                
                lucide.createIcons();
            } else {
                statusContainer.innerHTML = `<span class="error-msg"><i data-lucide="alert-circle" size="14"></i> ${t.msg_invalid}</span>`;
                lucide.createIcons();
                shakeModal();
            }
        } catch (error) {
            console.error(error);
            codeInput.disabled = false; 
            confirmBtn.disabled = false; 
            confirmBtn.textContent = t.modal_btn_auth;
            statusContainer.innerHTML = `<span class="error-msg">${t.msg_error}</span>`;
        }
    });

    function shakeModal() {
        modalContainer.animate([
            { transform: 'translateX(0)' }, { transform: 'translateX(-10px)' },
            { transform: 'translateX(10px)' }, { transform: 'translateX(0)' }
        ], { duration: 300 });
    }
</script>
</body>
</html>
